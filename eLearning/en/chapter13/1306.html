<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

  <title>Chapter 13</title>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

  <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
  <link href="../../css/ie10-viewport-bug-workaround.css" rel="stylesheet">

  <!-- Custom styles for this template -->
  <link href="../../css/dashboard.css" rel="stylesheet">

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
      <![endif]-->
       <style type="text/css">code{white-space: pre;}</style>
       <style type="text/css">.sidebar ul{padding-left: 10px;}</style>
       <script src="../../js/prism.js"></script>
       <link rel="stylesheet" href="../../css/prism.css">
       <script src="../../js/jquery.min.js"></script>    
       <script type="text/javascript" id="MathJax-script" async
	       src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
       </script>
       <script>
	 $(document).ready(function() {
  	     toc = $("#sidebar > ul > li > ul");
  	     sections = toc.children();   // <li>
  	     for(var i=0; i<sections.length; i++) {
  		 if ($(sections[i]).children().length == 1) { continue; }
  		 var first = sections[i].firstElementChild;  // <a>
  		 var last = sections[i].lastElementChild;
  		 var li = $("<li>");
  		 var details = $("<details>");
  		 var summary = $("<summary>");
  		 $(summary).append(first)
  		 $(details).append(summary);
  		 $(details).append(last);
  		 $(li).append(details);	
  		 $(sections[i]).replaceWith(li);
  	     }
	 });
	 </script>
       <link rel="stylesheet" href="../../css/pandoc.css">
       <script src="../../js/eBook.js"></script>
       <script src="../../../eStat/js/language.js" ></script>   
       <script src="../../../eStat/lib/d3/d3.v4.min.js"></script>   
       <script src="../../../eStat/lib/DistributionsUtil.js" ></script>
       <script src="../../../eStat/js/eStatU.js"></script>
       <script src="../../../eStat/lib/FileSaver.min.js" ></script>
       <script src="../../../eStat/lib/convertSVG.js"></script>
</head>
<body>

<nav class="navbar navbar-inverse navbar-fixed-top">
  <ul class="nav navbar-nav">
    <li class="dropdown">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Chapter<span class="caret"></span></a>
      <ul class="dropdown-menu"> 
        <li><a href="../index.html">HOME</a></li>
        <li><a href="../chapter01/index.html">Chapter 1</a></li>
        <li><a href="../chapter02/index.html">Chapter 2</a></li>
        <li><a href="../chapter03/index.html">Chapter 3</a></li>
        <li><a href="../chapter04/index.html">Chapter 4</a></li>
        <li><a href="../chapter05/index.html">Chapter 5</a></li>
        <li><a href="../chapter06/index.html">Chapter 6</a></li>
        <li><a href="../chapter07/index.html">Chapter 7</a></li>
        <li><a href="../chapter08/index.html">Chapter 8</a></li>
        <li><a href="../chapter09/index.html">Chapter 9</a></li>
        <li><a href="../chapter10/index.html">Chapter 10</a></li>
        <li><a href="../chapter11/index.html">Chapter 11</a></li>
        <li><a href="../chapter12/index.html">Chapter 12</a></li>
        <li><a href="../chapter13/index.html">Chapter 13</a></li>
      </ul>
    </li>
    <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Section<span class="caret"></span></a>
	  <ul class="dropdown-menu"> 
                <li><a href="../chapter13/1301.html">13.1 What is Time Series Analysis?</a></li>
                <li><a href="../chapter13/1302.html">13.2 Smoothing of Time Series</a></li>
                <li><a href="../chapter13/1303.html">13.3 Transformation of Time Series</a></li>
                <li><a href="../chapter13/1304.html">13.4 Regression Model and Forecasting</a></li>
                <li><a href="../chapter13/1305.html">13.5 Exponential Smoothing Model and Forecasting</a></li>
                <li><a href="../chapter13/1306.html">13.6 13.6 Seasonal Model and Forecasting</a></li>
                <li><a href="../chapter13/1307.html">13.7 Exercise</a></li>
	  </ul>
    </li>
    <li><a class="navbar-brand" href="../../../eStat/index.html" target="_blank">eStat</a></li>
    <li><a class="navbar-brand" href="../../../eStatU/index.html" target="_blank">eStatU</a></li>
    <li><a class="navbar-brand" href="../../Distribution/index.html" target="_blank">Distribution</a></li>
  </ul>
</nav>

<div class="container-fluid">
  <div class="row">
    <div id="sidebar" class="col-sm-3 col-md2 sidebar">
      <ul>
	<li><a href=""></a>
	  <ul>
            <li><a href="../index.html">HOME</a></li>
	    <li><a href="../chapter01/index.html">Chapter 1</a>
	      <ul>
                <li><a href="../chapter01/0101.html">1.1 Statistics and Data Science</a></li>
                <li><a href="../chapter01/0102.html">1.2 Population and Sample</a></li>
                <li><a href="../chapter01/0103.html">1.3 Variables and Data</a></li>
                <li><a href="../chapter01/0104.html">1.4 Softwares for Statistical Analysis</a></li>
                <li><a href="../chapter01/0105.html">1.5 Exercies</a></li>
	      </ul>
	    </li>
	    <li><a href="../chapter02/index.html">Chapter 2</a>
	      <ul>
                <li><a href="../chapter02/0201.html">2.1 Visualization of Qualitative Data</a></li>
                <li><a href="../chapter02/0202.html">2.2 Visualization of Summary Data</a></li>
                <li><a href="../chapter02/0202.html">&nbsp;&nbsp;2.2.1 Summary Data of Categorical Variable</a></li>
                <li><a href="../chapter02/0202.html">&nbsp;&nbsp;2.2.2 Summary Data of Categorical Variable with Group</a></li>
                <li><a href="../chapter02/0203.html">2.3 Visualization of Raw Data</a></li>
                <li><a href="../chapter02/0203.html">&nbsp;&nbsp;2.3.1 Raw Data of Categorical Variable</a></li>
                <li><a href="../chapter02/0203.html">&nbsp;&nbsp;2.3.2 Raw Data of Categorical Variable with Group</a></li>
                <li><a href="../chapter02/0204.html">2.4 Word Cloud</a></li>
                <li><a href="../chapter02/0205.html">2.5 Exercise</a></li>
	      </ul>
	    </li>
	    <li><a href="../chapter03/index.html">Chapter 3</a>
	      <ul>
                <li><a href="../chapter03/0301.html">3.1 Visualization of Quantitative Data</a></li> 
                <li><a href="../chapter03/0302.html">3.2 Visualization of Single Quantitative Variable</a></li>
                <li><a href="../chapter03/0302.html">&nbsp;&nbsp;3.2.1 Visualization of Quantitative Data without Group</a></li>
                <li><a href="../chapter03/0302.html">&nbsp;&nbsp;3.2.2 Visualization of Quantitative Data with Group</a></li>
                <li><a href="../chapter03/0303.html">3.3 Visualization of Two Quantitative Variables</a></li>
                <li><a href="../chapter03/0304.html">3.4 Exercise</a></li>
	      </ul>
	    </li>
	    <li><a href="../chapter04/index.html">Chapter 4</a>
	      <ul>
                <li><a href="../chapter04/0401.html">4.1 Frequency Table for Single Variable</a></li>
                <li><a href="../chapter04/0401.html">&nbsp;&nbsp;4.1.1 Frequency Table for Categorical Variable</a></li>
                <li><a href="../chapter04/0401.html">&nbsp;&nbsp;4.1.2 Frequency Table for Quantitative Variable</a></li>
                <li><a href="../chapter04/0402.html">4.2 Contingency Table for Two Variables</a></li>
                <li><a href="../chapter04/0402.html">&nbsp;&nbsp;4.2.1 Contingency Table for Two Categorical Variables</a></li>
                <li><a href="../chapter04/0402.html">&nbsp;&nbsp;4.2.2 Contingency Table for Two Quantitative Variables</a></li>
                <li><a href="../chapter04/040301.html">4.3 Summary Measures for Quantitative Variable</a></li>
                <li><a href="../chapter04/040301.html">&nbsp;&nbsp;4.3.1 Measures of Central Tendency</a></li>
                <li><a href="../chapter04/040302.html">&nbsp;&nbsp;4.3.2 Measures of Dispersion</a></li>
                <li><a href="../chapter04/0404.html">4.4 Exercise</a></li>
	      </ul>
	    </li>
	    <li><a href="../chapter05/index.html">Chapter 5</a>
	      <ul>
                <li><a href="../chapter05/0501.html">5.1 Definition of Probability</a></li>
                <li><a href="../chapter05/0502.html">5.2 Calculation of Probability</a></li>
                <li><a href="../chapter05/0503.html">5.3 Discrete Random Variable</a></li>
		<li><a href="../chapter05/050301.html">&nbsp;&nbsp;5.3.1 Binomial Distribution</a></li>
		<li><a href="../chapter05/050302.html">&nbsp;&nbsp;5.3.2 Poissson Distribution</a></li>
		<li><a href="../chapter05/050303.html">&nbsp;&nbsp;5.3.3 Geometric Distribution</a></li>
		<li><a href="../chapter05/050304.html">&nbsp;&nbsp;5.3.4 Hypergeometric Distribution</a></li>
                <li><a href="../chapter05/0504.html">5.4 Continuous Random Variable</a></li>
		<li><a href="../chapter05/050401.html">&nbsp;&nbsp;5.4.1 Normal Distribution</a></li>
		<li><a href="../chapter05/050402.html">&nbsp;&nbsp;5.4.2 Exponential Distribution</a></li>
                <li><a href="../chapter05/0505.html">5.5 Exercise</a></li>
	      </ul>
	    </li>
	    <li><a href="../chapter06/index.html">Chapter 6</a>
	      <ul>
                <li><a href="../chapter06/0601.html">6.1 Simple Random Sampling</a></li>
                <li><a href="../chapter06/060201.html">6.2 Sampling Distribution of Sample Means and Estimation of the Population Mean</a></li>
                <li><a href="../chapter06/060201.html">&nbsp;&nbsp;6.2.1 Sampling Distribution of Sample Means</a></li>
                <li><a href="../chapter06/060202.html">&nbsp;&nbsp;6.2.2 Estimation of the Population Mean</a></li>
                <li><a href="../chapter06/060301.html">6.3 Sampling Distribution of Sample Variances and Estimation of the Population Variance</a></li>
                <li><a href="../chapter06/060301.html">&nbsp;&nbsp;6.3.1 Sampling Distribution of Sample Variances</a></li>
                <li><a href="../chapter06/060302.html">&nbsp;&nbsp;6.3.2 Estimation of the Population Variance</a></li>
                <li><a href="../chapter06/060401.html">6.4 Sampling Distribution of Sample Proportions and Estimation of the Population Proportion</a></li>
                <li><a href="../chapter06/060401.html">&nbsp;&nbsp;6.4.1 Sampling Distribution of Sample Proportions</a></li>
                <li><a href="../chapter06/060402.html">&nbsp;&nbsp;6.4.2 Estimation of the Population Proportion</a></li>
                <li><a href="../chapter06/0605.html">6.5 Determination of the Sample Size  </a></li>
                <li><a href="../chapter06/0605.html">&nbsp;&nbsp;6.5.1 Determination of the Sample Size to Estimate the Population Mean </a></li>
                <li><a href="../chapter06/0605.html">&nbsp;&nbsp;6.5.2 Determination of the Sample Size to Estimate the Population Proportion</a></li> 
                <li><a href="../chapter06/0606.html">6.6 Exercise</a></li>
	      </ul>
	    </li>
	    <li><a href="../chapter07/index.html">Chapter 7</a>
	      <ul>
                <li><a href="../chapter07/0701.html">7.1 Testing Hypothesis for a Population Mean</a></li>
                <li><a href="../chapter07/0702.html">7.2 Testing Hypothesis for a Population Variance</a></li>
                <li><a href="../chapter07/0703.html">7.3 Testing Hypothesis for a Population Proportion</a></li>
                <li><a href="../chapter07/0704.html">7.4 Testing Hypothesis with α and β simultaneously</a></li>
                <li><a href="../chapter07/0704.html">&nbsp;&nbsp;7.4.1 Type 2 Error and Power of a Test</a></li>
                <li><a href="../chapter07/0704.html">&nbsp;&nbsp;7.4.2 Testing Hypothesis with α and β</a></li>
                <li><a href="../chapter07/0705.html">7.5 Exercise</a></li>
	      </ul>
	    </li>
	    <li><a href="../chapter08/index.html">Chapter 8</a>
	      <ul>
                <li><a href="../chapter08/080101.html">8.1 Testing Hypothesis for Two Population Means</a></li>
                <li><a href="../chapter08/080101.html">&nbsp;&nbsp;8.1.1 Two Independent Samples</a></li>
                <li><a href="../chapter08/080102.html">&nbsp;&nbsp;8.1.2 Paired Sample</a></li>
                <li><a href="../chapter08/0802.html">8.2 Testing Hypothesis for Two Population Variances</a></li>
                <li><a href="../chapter08/0803.html">8.3 Testing Hypothesis for Two Population Proportions</a></li>
                <li><a href="../chapter08/0804.html">8.4 Exercise</a></li>
	      </ul>
	    </li>
	    <li><a href="../chapter09/index.html">Chapter 9</a>
	      <ul>
                <li><a href="../chapter09/0901.html">9.1 Analysis of Variance for Experiments of Single Factor</a></li>
                <li><a href="../chapter09/090101.html">&nbsp;&nbsp;9.1.1 Multiple Comparison</a></li>
                <li><a href="../chapter09/090101.html">&nbsp;&nbsp;9.1.2 Residual Analysis</a></li>
                <li><a href="../chapter09/0902.html">9.2 Design of Experiments for Sampling</a></li>
                <li><a href="../chapter09/0902.html">&nbsp;&nbsp;9.2.1 Completely Randomized Design</a></li>
                <li><a href="../chapter09/0902.html">&nbsp;&nbsp;9.2.2 Randomized Block Design</a></li>
                <li><a href="../chapter09/0903.html">9.3 Analysis of Variance for Experiments of Two Factors</a></li>
                <li><a href="../chapter09/0904.html">9.4 Exercise</a></li>
	      </ul>
	    </li>
	    <li><a href="../chapter10/index.html">Chapter 10</a>
	      <ul>
                <li><a href="../chapter10/1001.html">10.1 Nonparametric Test for the Location Parameter of Single Population  </a></li>
                <li><a href="../chapter10/1001.html">&nbsp;&nbsp;10.1.1 Sign Test</a></li>
                <li><a href="../chapter10/100102.html">&nbsp;&nbsp;10.1.2 Wilcoxon Signed Rank Sum Test</a></li>
                <li><a href="../chapter10/1002.html">10.2 Nonparametric Test for Location Parameters of Two Populations</a></li>
                <li><a href="../chapter10/1002.html">&nbsp;&nbsp;10.2.1 Independent Samples: Wilcoxon Rank Sum Test</a></li>
                <li><a href="../chapter10/100202.html">&nbsp;&nbsp;10.2.2 Paired Samples: Wilcoxon Signed Rank Sum Test</a></li>
                <li><a href="../chapter10/1003.html">10.3 Nonparametric Test for Location Parameters of Several Populations</a></li>
                <li><a href="../chapter10/1003.html">&nbsp;&nbsp;10.3.1 Completely Randomized Design: Kruskal-Wallis Test</a></li>
                <li><a href="../chapter10/100302.html">&nbsp;&nbsp;10.3.2 Randomized Block Design: Friedman Test</a></li>
                <li><a href="../chapter10/1004.html">10.4 Exercise</a></li>
	      </ul>
	    </li>
	    <li><a href="../chapter11/index.html">Chapter 11</a>
	      <ul>
                <li><a href="../chapter11/1101.html">11.1 Goodness of Fit Test</a></li>
                <li><a href="../chapter11/1101.html">&nbsp;&nbsp;11.1.1 Goodness of Fit Test for Categorical Distribution</a></li>
                <li><a href="../chapter11/110102.html">&nbsp;&nbsp;11.1.2 Goodness of Fit Test for Continuous Distribution</a></li>
                <li><a href="../chapter11/1102.html">11.2 Testing Hypothesis for Contingency Table</a></li>
                <li><a href="../chapter11/1102.html">&nbsp;&nbsp;11.2.1 Independence Test</a></li>
                <li><a href="../chapter11/110202.html">&nbsp;&nbsp;11.2.2 Homogeneity Test</a></li>
                <li><a href="../chapter11/1103.html">11.3 Exercise</a></li>
	      </ul>
	    </li>
	    <li><a href="../chapter12/index.html">Chapter 12</a>
	      <ul>
                <li><a href="../chapter12/1201.html">12.1 Correlation Analysis</a></li>
                <li><a href="../chapter12/1202.html">12.2 Simple Linear Regression Analysis</a></li>
                <li><a href="../chapter12/1203.html">12.3 Multiple Linear Regression Analysis</a></li>
                <li><a href="../chapter12/1204.html">12.4 Exercise</a></li>
	      </ul>
	    </li>
	    <li><a href="../chapter13/index.html">Chapter 13</a>
	      <ul>
                <li><a href="../chapter13/1301.html">13.1 What is Time Series Analysis?</a></li>
                <li><a href="../chapter13/1302.html">13.2 Smoothing of Time Series</a></li>
                <li><a href="../chapter13/1303.html">13.3 Transformation of Time Series</a></li>
                <li><a href="../chapter13/1304.html">13.4 Regression Model and Forecasting</a></li>
                <li><a href="../chapter13/1305.html">13.5 Exponential Smoothing Model and Forecasting</a></li>
                <li><a href="../chapter13/1306.html">13.6 Seasonal Model and Forecasting</a></li>
                <li><a href="../chapter13/1307.html">13.7 Exercise</a></li>
	      </ul>
	    </li>

	  </ul>
	</li>
      </ul>
    </div>
  </div>
</div>

<div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">

  <!--***********************************************************************-->
  <h2>Chapter 13. Time Series Analysis</h2> 
  <p>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <button type="button" style="width:160px" onclick="moveSection(135)">&#10094; &nbsp;&nbsp;<b>Previous</b></button>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <button type="button" style="width:160px" onclick="moveSection(137)"><b>Next</b>&nbsp;&nbsp; &#10095;</button>
  <p>
  <h3>13.6 Seasonal Model and Forecasting</h3>
  <p>
<!---
  <h6>
      <a href="1202.pdf" target="_blank"><u>[presentation]</u></a>&nbsp;&nbsp;&nbsp;
      <a href="https://youtu.be/wn0Dl3dLgko" target="_blank"><u>[video]</u></a>
  </h6>
--->
  <p>

    <div class="mainTable">
      As a seasonal time series model, a multiplicative model using a central moving average and a Holt-Winters model are introduced.
    </div>
    <p>
    <h4>13.6.1 Seasonal Multiplicative Model</h4>
    <p>
    <div class="mainTable">
        Assume that a time series \(Y_t\) with a seasonal period \(L\) can be expressed as the product of 
        a trend (\(T\)), a seasonal (\(S\)), and an irregular component (\(I\)) as follows:
      $$
        Y_t \;=\; T_t  \cdot S_t \cdot I_t     
      $$
        The <b>ratio to moving average method</b> removes the trend and irregular components to obtain the seasonal component as follows
      <p>
        (Step 1) For the time series, find the \(L\)-point centered moving average. This moving average 
        represents the trend component \(T_t\) after removing seasonal component and irregular component 
        from the time series.
      <p>
        (Step 2) Divide the time series \(Y_t\) by the trend component \(T_t\) obtained in Step 1. This value 
        implies the seasonal component and the irregular component \({S_t \cdot I_t}\), and is called the 
        seasonal ratio. 
      <p>
      $$
        \frac{Y_t} {T_t  } \;=\; S_t \cdot I_t    
      $$
        (Step 3) Calculate the trimmed average for each seasonal ratio obtained in Step 2. This is 
        the seasonal index \(S_t\), but the normalization should be performed so that the sum of the seasonal 
        indices is \(L\).
      <p>
        After obtaining the seasonal index as shown, dividing the original time series data by the seasonal
        index. The results is called a <b>deseasonal time series</b>.
      <p>
         \( \qquad \text{Deseasonal time series:} \qquad  D_t \;=\; \frac{Y_t} {S_t } = T \cdot I      \)
      <p> 
        This deseasonal time series \(D_t\) implies \(T \cdot I\). An appropriate time series model 
        is applied to this deseasonal data and predict the future vaules. Then multiply the corresponding 
        seasonal index to obtain the final predicted value of the desired season.
      <p>
        [Table 13.6.1] shows a company's quarterly sales. Since the seasonal period is 4, the 4-point centered moving average is as shown in column 4 of the table. By dividing the original time series by a 4-point centered moving average, the seasonal ratio in column 5 can be calculated. 
      $$
        \frac{Y_t} {T_t } \;=\; S_t \cdot I_t    
      $$
      <p>
      <div class="textLeft">[Table 13.6.1] Quarterly Sales of a Company</div>
      <p>
     <table style="width:700px"> 
        <tr> 
          <th class="thGrey" style="width:50px"></th>
          <th class="thGrey" style="width:150px">①<br>Year  Quarter</th>
          <th class="thGrey" style="width:100px">②<br>Sales<br></th>
          <th class="thGrey" style="width:100px">③<br>4-point MA</th>
          <th class="thGrey" style="width:100px">④<br>Centered 4-point MA</th>
          <th class="thGrey" style="width:100px">⑤<br>Seasonal Ratio</th>
          <th class="thGrey" style="width:100px">⑥<br>Deseasonal Data \(D_t\)</th>
        </tr>
        <tr> 
           <td class="tdCenter">
             1<br>
             2<br>
             3<br>
             4<br>
             5<br>
             6<br>
             7<br>
             8<br>
             9<br>
             10<br>
             11<br>
             12<br>
             130<br>
             14<br>
             15<br>
             16<br>
           </td> 
           <td class="tdCenter">
             2018 Quarter 1<br>
             2018-Quarter 2<br>
             2018-Quarter 3<br>
             2018-Quarter 4<br>
             2019 Quarter 1<br>
             2019-Quarter 2<br>
             2019-Quarter 3<br>
             2019-Quarter 4<br>
             2020 Quarter 1<br>
             2020 Quarter 2<br>
             2020 Quarter 3<br>
             2020 Quarter 4<br>
             2021 Quarter 1<br>
             2021 Quarter 2<br>
             2021 Quarter 3<br>
             2021 Quarter 4<br>
           </td> 
           <td class="tdCenter">
             75<br>
             60<br>
             54<br>
             59<br>
             86<br>
             65<br>
             63<br>
             80<br>
             90<br>
             72<br>
             66<br>
             85<br>
             100<br>
             78<br>
             72<br>
             93<br>
           </td> 
           <td class="tdCenter">
             <br>
             <br>
             62.000<br>
             64.750<br>
             66.000<br>
             68.250<br>
             73.500<br>
             74.500<br>
             76.250<br>
             77.000<br>
             78.250<br>
             80.750<br>
             82.250<br>
             83.750<br>
             85.750<br>
             <br>
           </td> 
           <td class="tdCenter">
             <br>
             <br>
             63.375<br>
             65.375<br>
             67.125<br>
             70.875<br>
             74.000<br>
             75.375<br>
             76.625<br>
             77.625<br>
             79.500<br>
             81.500<br>
             83.000<br>
             84.750<br>
             <br>
             <br>
           </td> 
           <td class="tdCenter">
             <br>
             <br>
             0.852<br>
             0.902<br>
             1.281<br>
             0.917<br>
             0.851<br>
             1.061<br>
             1.175<br>
             0.928<br>
             0.830<br>
             1.043<br>
             1.205<br>
             0.920<br>
             <br>
             <br>
           </td> 
           <td class="tdCenter">
             62.552<br>
             65.502<br>
             63.754<br>
             56.840<br>
             71.726<br>
             70.961<br>
             74.380<br>
             77.071<br>
             75.063<br>
             78.603<br>
             77.922<br>
             81.888<br>
             83.403<br>
             85.153<br>
             85.006<br>
             89.595<br>
           </td> 
        </tr>
      </table>
      <p>
        [Table 13.6.2] shows the seasonal ratio by year and quarter. If the maximum and minimum values are removed for each quarter and the average is obtained (trimmed  average), it is the seasonal index in column 6. Since the sum of these values is 4.0197, the seasonal index in column is normalized as in column 7. 
      $$
        {\hat S}_1 \;=\; 1.199,\quad {\hat S}_2 \;=\; 0.916,\quad {\hat S}_3 \;=\; 0.847,\quad {\hat S}_4 \;=\; 1.038
      $$
      <p>
      <div class="textLeft">[Table 13.6.2] Seasonal Index</div>
      <p>
       <table style="width:720px"> 
        <tr> 
          <th class="thGrey" style="width:120px">①<br> &nbsp; &nbsp;&nbsp;&nbsp; Year<p>Quarter</th>
          <th class="thGrey" style="width:100px">②<br>2018</th>
          <th class="thGrey" style="width:100px">③<br>2019</th>
          <th class="thGrey" style="width:100px">④<br>2020</th>
          <th class="thGrey" style="width:100px">⑤<br>2021</th>
          <th class="thGrey" style="width:100px">⑥<br>Trimmed Mean</th>
          <th class="thGrey" style="width:100px">⑦<br>Seasonal Index<br>\(s_t\)</th>
        </tr>
        <tr> 
           <td class="tdCenter">
             1st Quarter<br>
             2nd Quarter<br>
             3rd Quarter<br>
             4th Quarter<br>
          </td> 
           <td class="tdCenter">
             <br>
             <br>
             0.852<br>
             0.902<br>
          </td> 
           <td class="tdCenter">
             1.281<br>
             0.917<br>
             0.851<br>
             1.061<br>
          </td> 
           <td class="tdCenter">
             1.175<br>
             0.928<br>
             0.830<br>
             1.043<br>
          </td> 
           <td class="tdCenter">
             1.205<br>
             0.920<br>
             <br>
             <br>
          </td> 
           <td class="tdCenter">
             1.205<br>
             0.920<br>
             0.851<br>
             1.043<br>
          </td> 
           <td class="tdCenter">
             1.199<br>
             0.916<br>
             0.847<br>
             1.038<br>
          </td> 
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td>sum 4.019</td>
          <td></td>
        </tr>
      </table>
      <p>
         Column 6 of [Table 13.6.1] shows the non-seasonal data \(D_t\) obtained by dividing the original 
         data by the seasonal index of each quarter. The linear regression line for this non-seasonal data is as follows (&lt;Figure 13.6.1&gt;).,
      $$
         D_{t} \;=\;  59.335 \;+\; 1.839 \cdot t  
      $$
         Therefore, the forecast for the next one year is as follows.
      $$
        \begin{align}
          & \text{Time 17 :} \quad{\hat Y}_{17} \;=\; (59.335 \;+\; 1.839 \times 17) \times 1.199 \;=\; 108.627 \\    
          & \text{Time 18 :} \quad{\hat Y}_{18} \;=\; (59.335 \;+\; 1.839 \times 18) \times 0.916 \;=\; 84.672  \\
          & \text{Time 19 :} \quad{\hat Y}_{19} \;=\; (59.335 \;+\; 1.839 \times 19) \times 0.847 \;=\; 79.852  \\
          & \text{Time 20 :} \quad{\hat Y}_{20} \;=\; (59.335 \;+\; 1.839 \times 20) \times 1.038 \;=\; 99.767  \\
        \end{align}
      $$
        &lt;Figure 13.6.2&gt; is a graph of seasonal forecasts.
      <p>

      <!---   ************ html for Time Series - Seasonal ************  ---->
      <b>[<span data-msgid="TimeSeries"></span>  <span data-msgid="Forecasting"></span> : <span data-msgid="SeasonalModel"></span>]</b><br>
      <b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Y = (<span data-msgid="Trend"></span>) × (<span data-msgid="Seasonal"></span>) × (<span data-msgid="Irregular"></span>)</b>
      <p>
            <input class="qrBtn" type="image" src="../../QR/eStatU370_TimeseriesSeasonal.svg" onclick="window.open(addrStr[138])">
      <p>
      <button type="button" id="erase" style="width:100px;"><b>New Data</b></button>
      <p>
      <table class="data">
	<tr>
	  <td><b>Y <span data-msgid="input data"></span></b></td>
	  <td colspan="3"><input type="text" size=73 id="data2"></td>
	</tr>
        <tr>
          <td style="text-align: right;"><b><span data-msgid="Main Title">Main Title</span></b>&nbsp;</td>
          <td colspan="3"><input type="text" size=50 id="mtitle"></td>
        </tr>
	<tr>
          <td style="text-align: right;"><b><span data-msgid="y title">y title</span></b>&nbsp;</td>
          <td><input type="text" size=15 id="ytitle"></td>
 	</tr>
	<tr>
          <td><b><span data-msgid="Nseason"></span></b></td>
          <td>&nbsp;&nbsp;L = <input type="number" min="2" max="12" value="4" id="ma1N" style="text-align:center" onchange="clearScreen()"> <span style="color:red;">( 2 ≤ L ≤ 12)</span></td>
        </tr>
      </table>   
      <p>
      <button type="button" id="execute"><span data-msgid="Execute">Execute</span></button>
      <table class="stat">
	<tr>
          <td><span data-msgid="ForecastingPeriod"></span></td>
          <td><input type="number" min="0" max="10" value="0" id="nn42" style="text-align:center" onchange="clearScreen()"></td>
 	  <td>&nbsp;&nbsp;<span data-msgid="NumberData"></span></td>         
	  <td><span class="fontmath">n<sub>Y</sub></span></td>
	  <td><input type="text" style="text-align:center;" size=6 id="nn41"> <span style="color:red;">( ≤ 120)</span></td>     
	</tr>
      </table>
      <svg id="chart" width="620" height="400" style="border-style:solid;"> </svg> 
      <form name="modelForm"> 
      <table>
        <tr>
          <td colspan="2"><span data-msgid="TrendModel"></span></td>
	</tr>
	<tr>
          <td>
            <label>
              <input type="radio" id="model1" name="model">&nbsp;&nbsp;<span data-msgid="Linear"></span>
            </label> 
          </td>
	  <td><span class="fontmath">y = b<sub>0</sub> + b<sub>1</sub> t</span></td>
          <td><input type="text" class="textarea" size=6 id="rsquare1" style="text-align: left;">&nbsp;</td>
          <td><input type="text" class="textarea" size=36 id="equation1" style="text-align: left;"></td>
	</tr>
	<tr>
          <td>
            <label>
              <input type="radio" id="model2" name="model">&nbsp;&nbsp;<span data-msgid="Quadratic"></span>
            </label> 
          </td>
	  <td><span class="fontmath">y = b<sub>0</sub> + b<sub>1</sub> t + b<sub>2</sub> t<sup>2</sup></span></td>
          <td><input type="text" class="textarea" size=6 id="rsquare2" style="text-align: left;">&nbsp;</td>
          <td><input type="text" class="textarea" size=36 id="equation2" style="text-align: left;"></td>
	</tr>
	<tr>
          <td>
            <label>
              <input type="radio" id="model3" name="model">&nbsp;&nbsp;<span data-msgid="Cubic"></span>
            </label> 
          </td>
	  <td><span class="fontmath">y = b<sub>0</sub>+b<sub>1</sub>t+b<sub>2</sub>t<sup>2</sup></span>+b<sub>3</sub>t<sup>3</sup></td>
          <td><input type="text" class="textarea" size=6 id="rsquare3" style="text-align: left;">&nbsp;</td>
          <td><input type="text" class="textarea" size=36 id="equation3" style="text-align: left;"></td>
	</tr>
	<tr>
          <td>
            <label>
              <input type="radio" id="model4" name="model">&nbsp;&nbsp;<span data-msgid="SquareRoot"></span>
            </label> 
          </td>
	  <td><span class="fontmath">y = b<sub>0</sub> + b<sub>1</sub> √t </span></td>
          <td><input type="text" class="textarea" size=6 id="rsquare4" style="text-align: left;">&nbsp;</td>
          <td><input type="text" class="textarea" size=36 id="equation4" style="text-align: left;"></td>
	</tr>
	<tr>
          <td>
            <label>
              <input type="radio" id="model5" name="model">&nbsp;&nbsp;<span data-msgid="Log"></span>
            </label> 
          </td>
	  <td><span class="fontmath">y = b<sub>0</sub> + b<sub>1</sub> ln(t)</span></td>
          <td><input type="text" class="textarea" size=6 id="rsquare5" style="text-align: left;"></td>
          <td><input type="text" class="textarea" size=36 id="equation5" style="text-align: left;"></td>
	</tr>
	<tr>
          <td>
            <label>
              <input type="radio" id="model6" name="model">&nbsp;&nbsp;<span data-msgid="Power"></span>
            </label> 
          </td>
	  <td><span class="fontmath">y = b<sub>0</sub> t <sup>b<sub>1</sub></sup></span></td>
          <td><input type="text" class="textarea" size=6 id="rsquare6" style="text-align: left;"></td>
          <td><input type="text" class="textarea" size=36 id="equation6" style="text-align: left;"></td>
	</tr>
	<tr>
          <td>
            <label>
              <input type="radio" id="model7" name="model">&nbsp;&nbsp;<span data-msgid="Exponent"></span>
            </label> 
          </td>
	  <td><span class="fontmath">y = b<sub>0</sub> e <sup>(b<sub>1</sub> t)</span></sup></td>
          <td><input type="text" class="textarea" size=6 id="rsquare7" style="text-align: left;"></td>
          <td><input type="text" class="textarea" size=36 id="equation7" style="text-align: left;"></td>
	</tr>
	<tr>
 	  <td><button type="button" id="saveGraphU"><span class="tooltiptext" data-msgid="Graph Save">Graph Save</span></button></td>               
          <td><button type="button" id="createTable"><span class="tooltiptext" data-msgid="ForecastTable"></span></button></td>
          <td><button type="button" id="saveTable"><span class="tooltiptext" data-msgid="SaveTable"></span></button></td>
        </tr>
      </table>
      </form>
      <p>
         <div class="figText">&lt;Figure 13.6.1&gt; Forcasting Model of Deseasonal Sales of a Company</div>
      <p>
      <div> 
        <div id="screenTable" >
          <div id="loc">
          </div>
        </div>
      </div>
      <p>
    </div>


    <!---   ************ script for Time Series - Seasonal ************  ---->
  <script>
      setLanguage('en');
      var svg     = d3.select("#chart"); 
      var i, r, k, k1, k2;
      var svgWidth    = 620;
      var svgHeight   = 400;
      var margin      = {top: 80, bottom: 50, left: 60, right: 60};
      var buffer      = 40;
      var graphWidth  = svgWidth - margin.left - margin.right;
      var graphHeight = svgHeight - margin.top - margin.bottom;
      var checkTitle  = true;
      var mTitle, yTitle, xTitle;
      var tobs, sst, sse, temp, model, str, tmin, tmax;
      var nforecast = 0;
      var xobs, xmin, xmax, xgap, gxmin, gxmax, gxrange;
      var yobs, ymin, ymax, ygap, gymin, gymax, gyrange;
      var x1, x2, y1, y2;
      var fontsize = "1em";
      var alpha = 0.05;
      var df, info, tvalue, nindep, mse, rmse;
      var sumS      = new Array(30);      
      var numS      = new Array(30);      
      var minS      = new Array(30);      
      var maxS      = new Array(30);      
      var stat1     = new Array(30);
      var stat2     = new Array(30);
      var stat3     = new Array(30);
      var stat4     = new Array(30);
      var stat5     = new Array(30);
      var stat6     = new Array(30);
      var stat7     = new Array(30);
      var beta2     = new Array(30);
      var beta3     = new Array(30);
      var tstat     = new Array(30);
      var rowmax    = 200;
      var tdata     = new Array(rowmax);
      var xdata     = new Array(rowmax);
      var ydata     = new Array(rowmax);
      var ytemp     = new Array(rowmax);
      var ylog      = new Array(rowmax);
      var MA        = new Array(rowmax);
      var yhat1     = new Array(rowmax);
      var S         = new Array(rowmax);
      var SI        = new Array(rowmax);
      var T         = new Array(rowmax);
      var dseason   = new Array(rowmax);
      var clow      = new Array(rowmax);
      var chigh     = new Array(rowmax);
      var checkModel    = new Array(10);
      var checkForecast = false;
      for (i=1; i<=7; i++) checkModel[i] = false;
      var nvar      = 10;
      var X         = new Array(nvar)
      var sumX      = new Array(nvar)
      var invXPX    = new Array(nvar);
      for (j = 0; j < nvar; j++) {
        invXPX[j] = new Array(nvar);
      }

      xTitle = "t";
      document.getElementById("nn41").disabled      = true;    
      document.getElementById("rsquare1").disabled  = true;    
      document.getElementById("rsquare2").disabled  = true;    
      document.getElementById("rsquare3").disabled  = true;       
      document.getElementById("rsquare4").disabled  = true;       
      document.getElementById("rsquare5").disabled  = true;       
      document.getElementById("rsquare6").disabled  = true;       
      document.getElementById("rsquare7").disabled  = true;       
      document.getElementById("equation1").disabled = true;    
      document.getElementById("equation2").disabled = true;    
      document.getElementById("equation3").disabled = true;       
      document.getElementById("equation4").disabled = true;       
      document.getElementById("equation5").disabled = true;       
      document.getElementById("equation6").disabled = true;       
      document.getElementById("equation7").disabled = true;
      svg.selectAll("*").remove();
      // input data control ===================================================
      d3.select("#data2").on("input", function() {
        stat = simplestat("#data2");  
        ydata = data; 
        yobs = stat.n;
      });
      updateData = function() {
        document.getElementById("data2").value = '';    
      }

      // model type
      var modelType = document.modelForm.model;
      modelType[0].onclick = function() { clearPrevious(); model = 1; checkModel[model] = true; drawModel1();}    
      modelType[1].onclick = function() { clearPrevious(); model = 2; checkModel[model] = true; drawModel2();}    
      modelType[2].onclick = function() { clearPrevious(); model = 3; checkModel[model] = true; drawModel3();}    
      modelType[3].onclick = function() { clearPrevious(); model = 4; checkModel[model] = true; drawModel4();}    
      modelType[4].onclick = function() { clearPrevious(); model = 5; checkModel[model] = true; drawModel5();}    
      modelType[5].onclick = function() { clearPrevious(); model = 6; checkModel[model] = true; drawModel6();}    
      modelType[6].onclick = function() { clearPrevious(); model = 7; checkModel[model] = true; drawModel7();}    
   
      // init example
      document.getElementById("data2").value = "75,60,54,59,86,65,63,80,90,72,66,85,100,78,72,93";
        stat = simplestat("#data2");  
        ydata = data; 
        yobs = stat.n;
      document.getElementById("mtitle").value = "Sales by Quarter";
      document.getElementById("ytitle").value = "million US$";
  
      // erase Data and Graph
      d3.select("#erase").on("click",function() {
        svg.selectAll("*").remove();
        document.getElementById("data2").value  = "";
        document.getElementById("mtitle").value = "";
        document.getElementById("ytitle").value = "";
        document.getElementById("nn41").value   = "";
        document.getElementById("nn42").value   = "0";
        document.getElementById("rsquare1").value  = "";    
        document.getElementById("rsquare2").value  = "";    
        document.getElementById("rsquare3").value  = "";       
        document.getElementById("rsquare4").value  = "";       
        document.getElementById("rsquare5").value  = "";       
        document.getElementById("rsquare6").value  = "";       
        document.getElementById("rsquare7").value  = "";       
        document.getElementById("equation1").value = "";    
        document.getElementById("equation2").value = "";    
        document.getElementById("equation3").value = "";       
        document.getElementById("equation4").value = "";       
        document.getElementById("equation5").value = "";       
        document.getElementById("equation6").value = "";       
        document.getElementById("equation7").value = "";
        document.getElementById("model1").checked  = false;
        document.getElementById("model2").checked  = false;
        document.getElementById("model3").checked  = false;
        document.getElementById("model4").checked  = false;
        document.getElementById("model5").checked  = false;
        document.getElementById("model6").checked  = false;
        document.getElementById("model7").checked  = false;
      })
  
      d3.select("#execute").on("click", function(){  
          svg.selectAll("*").remove();  // 전화면 제거
          clearScreenOnly();
          tobs = yobs;
          // 입력 도수에 숫자 문자 빈칸 있나 체크
          for (i=0; i<tobs; i++) {
            if ( isNaN(ydata[i]) ) {
              svg.append("text").attr("class","mean").attr("x", 250).attr("y", margin.top + 40)
                 .text(alertMsg[48][langNum]).style("stroke","red").style("font-size","1em");
              return;
            }
          }
          // title
          mTitle = d3.select("#mtitle").node().value;
          yTitle = d3.select("#ytitle").node().value;
          // time 1,2,... 통계량
          tobs = yobs;
          nforecast = 0;
          for (i = 0; i < tobs; i++) {
            tdata[i] = i + 1;   // time 1,2,3...
            xdata[i] = tdata[i];
          }
          model1Stat(tobs, tdata, xdata, ydata, stat1);
          sst = stat1[20];
          document.getElementById("nn41").value   = yobs;
          initialCordinate(tobs, tdata, ydata);    
          model = 1;
          showTimeSeriesPlot(model, tobs, nforecast, tdata, ydata, checkTitle);
          // Centered Moving Average for N season period => yhat1[i]
            ma1N = parseFloat(d3.select("#ma1N").node().value);
            for (i=0; i<tobs-ma1N+1; i++) {
              sum = 0;
              for (j=i; j<i+ma1N; j++) sum += ydata[j];
              MA[i] = sum / ma1N;
            }
            // N이 홀수 경우
            if (ma1N % 2 == 1) {
              k  = Math.floor((ma1N+1)/2);
              k1 = k-1;
              k2 = tobs - k1;
              for (i=k1; i<k2; i++) {
                yhat1[i] = MA[i-k1]
              }
            }
            else {
              k = Math.floor((ma1N)/2);
              k1 = k;
              k2 = tobs - k;
              for (i=k1; i<k2; i++) {
                yhat1[i] = 0.5*(MA[i-k1] + MA[i-k1+1]);
              }
            }
          // Seasonal 
            for (i=k1; i<k2; i++)  S[i] = ydata[i] / yhat1[i];
            tmin = S[k1];
            tmax = S[k1];
            for (i=k1; i<k2; i++)  {
              if (S[i] > tmax) tmax = S[i];
              if (S[i] < tmin) tmin = S[i];
            }
            for (i=0; i<ma1N; i++) {
              numS[i] = 0;
              sumS[i] = 0; 
              minS[i] = tmax;
              maxS[i] = tmin
            }
            for (i=k1; i<k2; i++) {
              k = i % ma1N;
              numS[k]++;
              sumS[k] += S[i];
              if (S[i] > maxS[k]) maxS[k] = S[i];
              if (S[i] < minS[k]) minS[k] = S[i];
            }
          // Adjusted Seasonal Index
            temp = 0;
            if (tobs > 3*ma1N) {
              for (k=0; k<ma1N; k++) {
                SI[k] = (sumS[k]-maxS[k]-minS[k]) / (numS[k]-2); 
                temp += SI[k];
              }
            } 
            else {
              for (k=0; k<ma1N; k++) {
                SI[k] = (sumS[k]) / (numS[k]); 
                temp += SI[k];
              }
            }
            for (k=0; k<ma1N; k++) {
              SI[k] = SI[k] * ma1N / temp;
            }
          // Deseasonal data
            for (i=0; i<tobs; i++) {
              k = i % ma1N;
              S[i] = SI[k];
              dseason[i] = ydata[i] / S[i];
            }
          showModel0(tobs, k1, k2, tdata, yhat1, dseason);
          model = 0;
          forecastTableS(model, tobs, nforecast, tstat, clow, chigh, S);     
      })
      // svg Graph Save
      d3.select("#saveGraphU").on("click", function() {
        var svg = d3.select("#chart");
        var width = svgWidth;
        var height = svgHeight;
        var svgString = getSVGString(svg.node());
        svgString2Image(svgString, width, height, 'png', save);
        function save(dataBlob, filesize) {
          saveAs(dataBlob, 'eStatGraphU.png');
        }
      });
      // create Table
      d3.select("#createTable").on("click", function() {
          if ( nforecast == 0 ) {alert("Enter forecasting period"); return;}
          if ( checkModel[1] ) {
            for (j=0; j<30; j++) tstat[j] = stat1[j];
            forecastTableS(1, tobs, nforecast, tstat, clow, chigh, S);     
          }
          if ( checkModel[2] ) {
            for (j=0; j<30; j++) tstat[j] = beta2[j];
            forecastTableS(2, tobs, nforecast, tstat, clow, chigh, S);    
          }
          if ( checkModel[3] ) {
            for (j=0; j<30; j++) tstat[j] = beta3[j];
            forecastTableS(3, tobs, nforecast, tstat, clow, chigh, S);     
          }
          if ( checkModel[4] ) {
            for (j=0; j<30; j++) tstat[j] = stat4[j];
            forecastTableS(4, tobs, nforecast, tstat, clow, chigh, S);   ;  
          }
          if ( checkModel[5] ) {
            for (j=0; j<30; j++) tstat[j] = stat5[j];
            forecastTableS(5, tobs, nforecast, tstat, clow, chigh, S);    
          }
          if ( checkModel[6] ) {
            for (j=0; j<30; j++) tstat[j] = stat6[j];
            forecastTableS(6, tobs, nforecast, tstat, clow, chigh, S);   
          }
          if ( checkModel[7] ) {
            for (j=0; j<30; j++) tstat[j] = stat7[j];
            forecastTableS(7, tobs, nforecast, tstat, clow, chigh, S);            
          }
      });
      // save Table
      d3.select("#saveTable").on("click", function() {
        head = '<html><head><meta charset="UTF-8"></head><body>';
        tail = '</body></html>';
        saveAs(new Blob([head + d3.select("#screenTable").html() + tail]), "eStatULog.html");
      });
// Linear
function drawModel1() {
            for (i=0; i<tobs; i++) xdata[i] = tdata[i];  
            model1Stat(tobs, tdata, xdata, dseason, stat1);
            for (i=tobs; i<tobs+nforecast; i++) tdata[i] = i+1;
            for (i=tobs; i<tobs+nforecast; i++) dseason[i] = stat1[7] + stat1[8]*tdata[i];
            // MSE
            mse = 0;
            for (i=0; i<tobs; i++) {
              temp = dseason[i] - (stat1[7]+stat1[8]*tdata[i]);
              mse += temp*temp;
            }
            rmse = mse / (tobs-2);
            df = tobs - 2;
            tvalue = t_inv(1-alpha/2, df, info);
            if (nforecast > 0) {
              for (i=tobs; i<tobs+nforecast; i++) {
                j = (i-tobs) % ma1N;
                k = Math.floor( (i-tobs)/ma1N ) + 1;
                ydata[i] = dseason[i]*SI[j];
                clow[i]  = (dseason[i] - tvalue*rmse*Math.sqrt(k))*SI[j];
                chigh[i] = (dseason[i] + tvalue*rmse*Math.sqrt(k))*SI[j];;
              }
              confidenceBand(model, tobs, nforecast, clow, chigh);
            }
            showModel1(stat1, checkTitle);
            document.getElementById("rsquare1").value = "r\u00B2 = " + f4(stat1[10]);    
            document.getElementById("equation1").value = "y = ("+f4(stat1[7])+") + ("+f4(stat1[8])+")t";  
}
// Quadratic
function drawModel2() {
            statRegression(3, tobs, dseason, beta2, stat2)
            beta2[10] = stat2[13];
            for (i=tobs; i<tobs+nforecast; i++) tdata[i] = i+1;
            for (i=tobs; i<tobs+nforecast; i++) dseason[i] = beta2[0] + beta2[1]*tdata[i] + beta2[2]*tdata[i]*tdata[i];
        if (nforecast > 0) {
            // confidence interval
            df = tobs - 3;
            nindep = 3;
            tvalue = t_inv(1-alpha/2, df, info);
            // x' (X'X)^-1 x
            for (i=tobs; i<tobs+nforecast; i++) {
              X[0] = 1;
              X[1] = tdata[i];
              X[2] = tdata[i]*tdata[i]; 
              for (j=0; j<nindep; j++) {
                sumX[j] = 0;
                for (k=0; k<nindep; k++) {
                  sumX[j] += X[k]*invXPX[k][j];
                }
              }
              temp = 0;
              for (j=0; j<nindep; j++) {
                temp += sumX[j]*X[j];
              }
              temp1 = tvalue * Math.sqrt(stat2[8]*temp);
              j = (i-tobs) % ma1N;
              k = Math.floor( (i-tobs)/ma1N ) + 1;
              ydata[i] = dseason[i]*SI[j];
              clow[i]  = (dseason[i] - temp1*Math.sqrt(k))*SI[j];
              chigh[i] = (dseason[i] + temp1*Math.sqrt(k))*SI[j];;
            }
            confidenceBand(model, tobs, nforecast, clow, chigh);
        }
            showModel2(beta2, ydata, checkTitle);
            document.getElementById("rsquare2").value = "r\u00B2 = " + f4(stat2[13]);    
            document.getElementById("equation2").value = "y = ("+f4(beta2[0])+") + ("+f4(beta2[1])+")t +("+f4(beta2[2])+")t\u00B2";  
}
// Cubic
function drawModel3() {
            statRegression(4, tobs, dseason, beta3, stat3)
            beta3[10] = stat3[13];
            for (i=tobs; i<tobs+nforecast; i++) tdata[i] = i+1;
            for (i=tobs; i<tobs+nforecast; i++) dseason[i] = beta3[0] + beta3[1]*tdata[i] + beta3[2]*tdata[i]*tdata[i] + beta3[3]*tdata[i]*tdata[i]*tdata[i];
        if (nforecast > 0) {
            // confidence interval
            df = tobs - 4;
            nindep = 4;
            tvalue = t_inv(1-alpha/2, df, info);
            // x' (X'X)^-1 x
            for (i=tobs; i<tobs+nforecast; i++) {
              X[0] = 1;
              X[1] = tdata[i];
              X[2] = tdata[i]*tdata[i]; 
              X[3] = X[2]*tdata[i];
              for (j=0; j<nindep; j++) {
                sumX[j] = 0;
                for (k=0; k<nindep; k++) {
                  sumX[j] += X[k]*invXPX[k][j];
                }
              }
              temp = 0;
              for (j=0; j<nindep; j++) {
                temp += sumX[j]*X[j];
              }
              temp1 = tvalue * Math.sqrt(stat3[8]*temp);
              j = (i-tobs) % ma1N;
              k = Math.floor( (i-tobs)/ma1N ) + 1;
              ydata[i] = dseason[i]*SI[j];
              clow[i]  = (dseason[i] - temp1*Math.sqrt(k))*SI[j];
              chigh[i] = (dseason[i] + temp1*Math.sqrt(k))*SI[j];;
            }
            confidenceBand(model, tobs, nforecast, clow, chigh);
        }
            showModel3(beta3, ydata, checkTitle);
            document.getElementById("rsquare3").value = "r\u00B2 = " + f4(stat3[13]);    
            document.getElementById("equation3").value = "y=("+f4(beta3[0])+")+("+f4(beta3[1])+")t+("+f4(beta3[2])+")t\u00B2+("+f4(beta3[3])+")t\u00B3";  
}
// Model4: y = a + b * sqrt(t) 
function drawModel4() {
            for (i=0; i<tobs; i++) xdata[i] = Math.sqrt(tdata[i])  
            model1Stat(tobs, tdata, xdata, dseason, stat4);
            for (i=tobs; i<tobs+nforecast; i++) tdata[i] = i+1;
            for (i=tobs; i<tobs+nforecast; i++) dseason[i] = stat4[7] + stat4[8]*Math.sqrt(tdata[i]);
            // MSE
            mse = 0;
            for (i=0; i<tobs; i++) {
              temp = dseason[i] - (stat4[7] + stat4[8]*Math.sqrt(tdata[i]));
              mse += temp*temp;
            }
            rmse = mse / (tobs-2);
            df = tobs - 2;
            tvalue = t_inv(1-alpha/2, df, info); 
            if (nforecast > 0) {
              for (i=tobs; i<tobs+nforecast; i++) {
                j = (i-tobs) % ma1N;
                k = Math.floor( (i-tobs)/ma1N ) + 1;
                ydata[i] = dseason[i]*SI[j];
                clow[i]  = (dseason[i] - tvalue*rmse*Math.sqrt(k))*SI[j];
                chigh[i] = (dseason[i] + tvalue*rmse*Math.sqrt(k))*SI[j];;
              }
              confidenceBand(model, tobs, nforecast, clow, chigh);
            }
            showModel4(stat4, ydata, checkTitle); 
            document.getElementById("rsquare4").value  = "r\u00B2 = " + f4(stat4[10]);    
            document.getElementById("equation4").value = "y = ("+f4(stat4[7])+") + ("+f4(stat4[8])+") √t";  
}
// Model5: y = a + b * ln(t) 
function drawModel5() {
            for (i=0; i<tobs; i++) xdata[i] = Math.log(tdata[i])  
            model1Stat(tobs, tdata, xdata, dseason, stat5);
            for (i=tobs; i<tobs+nforecast; i++) tdata[i] = i+1;
            for (i=tobs; i<tobs+nforecast; i++) dseason[i] = stat5[7] + stat5[8]*Math.log(tdata[i]);
            // MSE
            mse = 0;
            for (i=0; i<tobs; i++) {
              temp = dseason[i] - (stat5[7] + stat5[8]*Math.log(tdata[i]));
              mse += temp*temp;
            }
            rmse = mse / (tobs-2);
            df = tobs - 2;
            tvalue = t_inv(1-alpha/2, df, info); 
            if (nforecast > 0) {
              for (i=tobs; i<tobs+nforecast; i++) {
                j = (i-tobs) % ma1N;
                k = Math.floor( (i-tobs)/ma1N ) + 1;
                ydata[i] = dseason[i]*SI[j];
                clow[i]  = (dseason[i] - tvalue*rmse*Math.sqrt(k))*SI[j];
                chigh[i] = (dseason[i] + tvalue*rmse*Math.sqrt(k))*SI[j];;
              }
              confidenceBand(model, tobs, nforecast, clow, chigh);
            }
            showModel5(stat5, ydata, checkTitle);
            document.getElementById("rsquare5").value  = "r\u00B2 = " + f4(stat5[10]);    
            document.getElementById("equation5").value = "y = ("+f4(stat5[7])+") + ("+f4(stat5[8])+") ln(t)"; 
}
// Model6: y = a t^b  =>  ln(y) = ln(a) + b * ln(t) 
function drawModel6() {
            for (i=0; i<tobs; i++) {
              xdata[i] = Math.log(tdata[i]);
              ylog[i]  = Math.log(dseason[i]);
            }
            model1Stat(tobs, tdata, xdata, ylog, stat6);
            sse = 0;
            for (i=0; i<tobs; i++) {
              temp = ydata[i] - Math.exp(stat6[7]) * Math.pow(tdata[i],stat6[8]);  
              sse += temp * temp;
            }
            stat6[10] = 1 - sse/sst;
            rmse = mse / (tobs-2);
            df = tobs - 2;
            tvalue = t_inv(1-alpha/2, df, info);
            for (i=tobs; i<tobs+nforecast; i++) tdata[i] = i+1;
            for (i=tobs; i<tobs+nforecast; i++) dseason[i] = Math.exp(stat6[7]) * Math.pow(tdata[i],stat6[8]);
            if (nforecast > 0) {
              for (i=tobs; i<tobs+nforecast; i++) {
                j = (i-tobs) % ma1N;
                k = Math.floor( (i-tobs)/ma1N ) + 1;
                ydata[i] = dseason[i]*SI[j];
                clow[i]  = (dseason[i] - tvalue*rmse*Math.sqrt(k))*SI[j];
                chigh[i] = (dseason[i] + tvalue*rmse*Math.sqrt(k))*SI[j];;
              }
              confidenceBand(model, tobs, nforecast, clow, chigh);
            }
            showModel6(stat6, ydata, checkTitle);
            document.getElementById("rsquare6").value  = "r\u00B2 = " + f4(stat6[10]);    
            document.getElementById("equation6").value = "y = ("+f4(Math.exp(stat6[7]))+") t ^ ("+f4(stat6[8])+")"; 
}
// Model7: y = a e^(bt)  =>  ln(y) = ln(a) + b t 
function drawModel7() {
            for (i=0; i<tobs; i++) {
              xdata[i] = tdata[i];  
              ylog[i]  = Math.log(dseason[i])  
            }
            model1Stat(tobs, tdata, xdata, ylog, stat7);
            sse = 0;
            for (i=0; i<tobs; i++) {
              temp = ydata[i] - Math.exp(stat7[7]) * Math.exp(stat7[8]*tdata[i]); 
              sse += temp * temp;
            }
            stat7[10] = 1 - sse/sst;
            rmse = mse / (tobs-2);
            df = tobs - 2;
            tvalue = t_inv(1-alpha/2, df, info);
            for (i=tobs; i<tobs+nforecast; i++) tdata[i] = i+1;
            for (i=tobs; i<tobs+nforecast; i++) dseason[i] = Math.exp(stat7[7]) * Math.exp(stat7[8]*tdata[i]);
            if (nforecast > 0) {
              for (i=tobs; i<tobs+nforecast; i++) {
                j = (i-tobs) % ma1N;
                k = Math.floor( (i-tobs)/ma1N ) + 1;
                ydata[i] = dseason[i]*SI[j];
                clow[i]  = (dseason[i] - tvalue*rmse*Math.sqrt(k))*SI[j];
                chigh[i] = (dseason[i] + tvalue*rmse*Math.sqrt(k))*SI[j];;
              }
              confidenceBand(model, tobs, nforecast, clow, chigh);
            }
            showModel7(stat7, ydata, checkTitle);
            document.getElementById("rsquare7").value  = "r\u00B2 = " + f4(stat7[10]);    
            document.getElementById("equation7").value = "y = ("+f4(Math.exp(stat7[7]))+") exp( "+f4(stat7[8])+" t )";    
}

// 
function showModel0(tobs, k1, k2, tdata, yhat, ydata) {
     var cx, cy;
     var x1, y1, x2, y2;
/*
     // plot MA yhat[i]
     for (i=k1; i<k2; i++) {
       cx = margin.left+graphWidth*(tdata[i]-gxmin)/gxrange;
       cy = margin.top+graphHeight-graphHeight*(yhat[i]-gymin)/gyrange; 
       svg.append("circle").attr("class","reglabel0")
          .attr("cx", cx)
          .attr("cy", cy)         
          .attr("r", 3)
          .style("fill",myColor[13])
     }
     x1  = margin.left + graphWidth*(tdata[k1]-gxmin)/gxrange;
     y1  = margin.top  + graphHeight - graphHeight*(yhat[k1]-gymin)/gyrange;
     for (i=k1+1; i<k2; i++) {
       x2  = margin.left + graphWidth*(tdata[i]-gxmin)/gxrange;
       y2  = margin.top  + graphHeight - graphHeight*(yhat[i]-gymin)/gyrange;
       svg.append("line").attr("class","reglabel0")
          .attr("x1",x1)
          .attr("y1",y1)
          .attr("x2",x2)
          .attr("y2",y2)
          .style("stroke",myColor[13]) 
       x1 = x2;
       y1 = y2;
     }
*/
     // plot Deseasonal ydata[i]
     for (i=0; i<tobs; i++) {
       cx = margin.left+graphWidth*(tdata[i]-gxmin)/gxrange;
       cy = margin.top+graphHeight-graphHeight*(ydata[i]-gymin)/gyrange; 
       svg.append("circle").attr("class","reglabel0")
          .attr("cx", cx)
          .attr("cy", cy)         
          .attr("r", 3)
          .style("fill","red")
     }
     x1  = margin.left + graphWidth*(tdata[0]-gxmin)/gxrange;
     y1  = margin.top  + graphHeight - graphHeight*(ydata[0]-gymin)/gyrange;
     for (i=1; i<tobs; i++) {
       x2  = margin.left + graphWidth*(tdata[i]-gxmin)/gxrange;
       y2  = margin.top  + graphHeight - graphHeight*(ydata[i]-gymin)/gyrange;
       svg.append("line").attr("class","reglabel0")
          .attr("x1",x1)
          .attr("y1",y1)
          .attr("x2",x2)
          .attr("y2",y2)
          .style("stroke","red") 
       x1 = x2;
       y1 = y2;
     }
     // title   
/*
     svg.append("text").attr("class","reglabel0")
                .attr("x", margin.left + graphWidth/2)
                .attr("y", margin.top + graphHeight - 40)
                .text("Centered MA("+ma1N+")")
                .style("stroke",myColor[13]) 
*/
     svg.append("text").attr("class","reglabel0")
                .attr("x", margin.left + graphWidth/2)
                .attr("y", margin.top + graphHeight - 20)
                .text(svgStrU[133][langNum])     // deseasonal
                .style("stroke","red") 

}
// 회귀선 그리기 함수
function showModel1(stat, checkTitle) {
     var cx, cy, temp, rmse;
     var x1, y1, x2, y2;
     // forecasting
     for (i=tobs; i<tobs+nforecast; i++) {
          temp = (stat[7]+stat[8]*tdata[i])*SI[i % ma1N];
          cx = margin.left+graphWidth*(tdata[i]-gxmin)/gxrange;
          cy = margin.top+graphHeight-graphHeight*(temp-gymin)/gyrange; 
          svg.append("circle").attr("class","reglabel1")
             .attr("cx", cx)
             .attr("cy", cy)         
             .attr("r", 3)
             .style("fill",myColor[1])
     }
     x1  = margin.left + graphWidth*(tdata[tobs-1]-gxmin)/gxrange;
     y1  = margin.top  + graphHeight - graphHeight*(ydata[tobs-1]-gymin)/gyrange;
     for (i=tobs; i<tobs+nforecast; i++) {
          temp = (stat[7]+stat[8]*tdata[i])*SI[i % ma1N];
          x2 = margin.left+graphWidth*(tdata[i]-gxmin)/gxrange;
          y2 = margin.top+graphHeight-graphHeight*(temp-gymin)/gyrange; 
          svg.append("line").attr("class","reglabel1")
                .attr("x1",x1)
                .attr("y1",y1)
                .attr("x2",x2)
                .attr("y2",y2)
                .style("stroke",myColor[1])
          x1 = x2;
          y1 = y2; 
     }

     // trend line
     x1  = margin.left + graphWidth*(stat[3]-gxmin)/gxrange;
     y1  = margin.top  + graphHeight - graphHeight*((stat[7]+stat[8]*stat[3])-gymin)/gyrange;
     x2  = margin.left + graphWidth*(xmax-gxmin)/gxrange;
     y2  = margin.top  + graphHeight - graphHeight*((stat[7]+stat[8]*xmax)-gymin)/gyrange;
     svg.append("line").attr("class","reglabel1")
                .attr("x1",x1)
                .attr("y1",y1)
                .attr("x2",x2)
                .attr("y2",y2)
                .style("stroke",myColor[1]) 


     if(checkTitle) {   
        svg.append("text").attr("class","reglabel1")
                .attr("x", margin.left + 20)
                .attr("y", margin.top +  20)
                .text("y = ("+f4(stat[7])+") + ("+f4(stat[8])+ ") t , " + " r\u00B2 = "+f4(stat[10]))
                .style("stroke",myColor[1]) 
     }
}
function showModel2(stat, ydata, checkTitle) {
     var cx, cy;
     var x1, y1, x2, y2, temp;
     // forecasting
     for (i=tobs; i<tobs+nforecast; i++) {
          cx = margin.left+graphWidth*(tdata[i]-gxmin)/gxrange;
          cy = margin.top+graphHeight-graphHeight*(ydata[i]-gymin)/gyrange; 
          svg.append("circle").attr("class","reglabel2")
             .attr("cx", cx)
             .attr("cy", cy)         
             .attr("r", 3)
             .style("fill",myColor[1])
     }
     x1  = margin.left + graphWidth*(tdata[tobs-1]-gxmin)/gxrange;
     y1  = margin.top  + graphHeight - graphHeight*(ydata[tobs-1]-gymin)/gyrange;
     for (i=tobs; i<tobs+nforecast; i++) {
          x2 = margin.left+graphWidth*(tdata[i]-gxmin)/gxrange;
          y2 = margin.top+graphHeight-graphHeight*(ydata[i]-gymin)/gyrange; 
          svg.append("line").attr("class","reglabel1")
                .attr("x1",x1)
                .attr("y1",y1)
                .attr("x2",x2)
                .attr("y2",y2)
                .style("stroke",myColor[1])
          x1 = x2;
          y1 = y2; 
     }
     // trend line
     var ninterval = 100;
     var gxgap     = (tobs + nforecast) / ninterval;
     x1  = margin.left + graphWidth*(1-gxmin)/gxrange;
     y1  = margin.top  + graphHeight - graphHeight*((stat[0]+stat[1]*1+ stat[2]*1*1 )-gymin)/gyrange;
     temp = 1;
     for (i = 1; i < ninterval-4; i++) {
          temp += gxgap;
          x2  = margin.left + graphWidth*(temp-gxmin)/gxrange;
          y2  = margin.top  + graphHeight - graphHeight*((stat[0]+stat[1]*temp+stat[2]*temp*temp)-gymin)/gyrange;
          svg.append("line").attr("class","reglabel2")
                .attr("x1",x1)
                .attr("y1",y1)
                .attr("x2",x2)
                .attr("y2",y2)
                .style("stroke",myColor[2]) 
          x1 = x2;
          y1 = y2;
     }
     if(checkTitle) {   
        svg.append("text").attr("class","reglabel2")
                .attr("x", margin.left + 20)
                .attr("y", margin.top +  20)
                .text("y = ("+f4(stat[0])+") + ("+ f4(stat[1])+ ")t +("+ f4(stat[2])+")t\u00B2 , " + " r\u00B2 = "+f4(stat[10]))
                .style("stroke",myColor[2]) 
     }
}
function showModel3(stat, ydata, checkTitle) {
     var cx, cy;
     var x1, y1, x2, y2, temp;
     // forecasting
     for (i=tobs; i<tobs+nforecast; i++) {
          cx = margin.left+graphWidth*(tdata[i]-gxmin)/gxrange;
          cy = margin.top+graphHeight-graphHeight*(ydata[i]-gymin)/gyrange; 
          svg.append("circle").attr("class","reglabel3")
             .attr("cx", cx)
             .attr("cy", cy)         
             .attr("r", 3)
             .style("fill",myColor[1])
     }
     x1  = margin.left + graphWidth*(tdata[tobs-1]-gxmin)/gxrange;
     y1  = margin.top  + graphHeight - graphHeight*(ydata[tobs-1]-gymin)/gyrange;
     for (i=tobs; i<tobs+nforecast; i++) {
          x2 = margin.left+graphWidth*(tdata[i]-gxmin)/gxrange;
          y2 = margin.top+graphHeight-graphHeight*(ydata[i]-gymin)/gyrange; 
          svg.append("line").attr("class","reglabel1")
                .attr("x1",x1)
                .attr("y1",y1)
                .attr("x2",x2)
                .attr("y2",y2)
                .style("stroke",myColor[1])
          x1 = x2;
          y1 = y2; 
     }
     // trend line
     var ninterval = 100;
     var gxgap     = gxrange / ninterval;
     x1  = margin.left + graphWidth*(1-gxmin)/gxrange;
     y1  = margin.top  + graphHeight - graphHeight*((stat[0]+stat[1]*1+ stat[2]*1*1 + stat[3] )-gymin)/gyrange;
     for (i = 1; i < ninterval-6; i++) {
          temp = 1+i*gxgap;
          x2  = margin.left + graphWidth*(temp-gxmin)/gxrange;
          y2  = margin.top  + graphHeight - graphHeight*((stat[0]+stat[1]*temp+stat[2]*temp*temp+stat[3]*temp*temp*temp)-gymin)/gyrange;
          svg.append("line").attr("class","reglabel3")
                .attr("x1",x1)
                .attr("y1",y1)
                .attr("x2",x2)
                .attr("y2",y2)
                .style("stroke",myColor[3]) 
          x1 = x2;
          y1 = y2;
     }
     if(checkTitle) {   
        svg.append("text").attr("class","reglabel3")
                .attr("x", margin.left + 20)
                .attr("y", margin.top +  20)
                .text("y = ("+f4(stat[0])+") + ("+ f4(stat[1])+ ")t +("+ f4(stat[2])+")t\u00B2 "+f4(stat[3])+")t\u00B3 , " + " r\u00B2 = "+f4(stat[10]))
                .style("stroke",myColor[3]) 
     }
}
function showModel4(stat, ydata, checkTitle) {
     var cx, cy, temp;
     var x1, y1, x2, y2;
     // forecasting
     for (i=tobs; i<tobs+nforecast; i++) {
          cx = margin.left+graphWidth*(tdata[i]-gxmin)/gxrange;
          cy = margin.top+graphHeight-graphHeight*(ydata[i]-gymin)/gyrange; 
          svg.append("circle").attr("class","reglabel4")
             .attr("cx", cx)
             .attr("cy", cy)         
             .attr("r", 3)
             .style("fill",myColor[1])
     }
     x1  = margin.left + graphWidth*(tdata[tobs-1]-gxmin)/gxrange;
     y1  = margin.top  + graphHeight - graphHeight*(ydata[tobs-1]-gymin)/gyrange;
     for (i=tobs; i<tobs+nforecast; i++) {
          x2 = margin.left+graphWidth*(tdata[i]-gxmin)/gxrange;
          y2 = margin.top+graphHeight-graphHeight*(ydata[i]-gymin)/gyrange; 
          svg.append("line").attr("class","reglabel1")
                .attr("x1",x1)
                .attr("y1",y1)
                .attr("x2",x2)
                .attr("y2",y2)
                .style("stroke",myColor[1])
          x1 = x2;
          y1 = y2; 
     }
     // trend line
     var ninterval = 100;
     var gxgap     = gxrange / ninterval;

     x1  = margin.left + graphWidth*(stat[3]-gxmin)/gxrange;
     y1  = margin.top  + graphHeight - graphHeight*((stat[7]+stat[8]*Math.sqrt(stat[3]))-gymin)/gyrange;
     for (i = 1; i < ninterval-6; i++) {
          x2  = margin.left + graphWidth*(stat[3]+i*gxgap-gxmin)/gxrange;
          y2  = margin.top  + graphHeight - graphHeight*((stat[7]+stat[8]*Math.sqrt(stat[3]+i*gxgap))-gymin)/gyrange;
          svg.append("line").attr("class","reglabel4")
                .attr("x1",x1)
                .attr("y1",y1)
                .attr("x2",x2)
                .attr("y2",y2)
                .style("stroke",myColor[4]) 
          x1 = x2;
          y1 = y2;
     }
     if(checkTitle) {   
        svg.append("text").attr("class","reglabel4")
                .attr("x", margin.left + 20)
                .attr("y", margin.top +  20)
                .text("y = ("+f4(stat[7])+") + ("+ f4(stat[8])+ ") √ t , " + " r\u00B2 = "+f4(stat[10]))
                .style("stroke",myColor[4]) 
     }
}
function showModel5(stat, ydata, checkTitle) {
     var cx, cy, temp;
     var x1, y1, x2, y2;
     // forecasting
     for (i=tobs; i<tobs+nforecast; i++) {
          cx = margin.left+graphWidth*(tdata[i]-gxmin)/gxrange;
          cy = margin.top+graphHeight-graphHeight*(ydata[i]-gymin)/gyrange; 
          svg.append("circle").attr("class","reglabel5")
             .attr("cx", cx)
             .attr("cy", cy)         
             .attr("r", 3)
             .style("fill",myColor[1])
     }
     x1  = margin.left + graphWidth*(tdata[tobs-1]-gxmin)/gxrange;
     y1  = margin.top  + graphHeight - graphHeight*(ydata[tobs-1]-gymin)/gyrange;
     for (i=tobs; i<tobs+nforecast; i++) {
          x2 = margin.left+graphWidth*(tdata[i]-gxmin)/gxrange;
          y2 = margin.top+graphHeight-graphHeight*(ydata[i]-gymin)/gyrange; 
          svg.append("line").attr("class","reglabel1")
                .attr("x1",x1)
                .attr("y1",y1)
                .attr("x2",x2)
                .attr("y2",y2)
                .style("stroke",myColor[1])
          x1 = x2;
          y1 = y2; 
     }
     // trend line
     var ninterval = 100;
     var gxgap     = gxrange / ninterval;

     x1  = margin.left + graphWidth*(stat[3]-gxmin)/gxrange;
     y1  = margin.top  + graphHeight - graphHeight*((stat[7]+stat[8]*Math.log(stat[3]))-gymin)/gyrange;
     for (i = 1; i < ninterval-6; i++) {
          x2  = margin.left + graphWidth*(stat[3]+i*gxgap-gxmin)/gxrange;
          y2  = margin.top  + graphHeight - graphHeight*((stat[7]+stat[8]*Math.log(stat[3]+i*gxgap))-gymin)/gyrange;
          svg.append("line").attr("class","reglabel5")
                .attr("x1",x1)
                .attr("y1",y1)
                .attr("x2",x2)
                .attr("y2",y2)
                .style("stroke",myColor[5]) 
          x1 = x2;
          y1 = y2;
     }
     if(checkTitle) {   
        svg.append("text").attr("class","reglabel5")
                .attr("x", margin.left + 20)
                .attr("y", margin.top +  20)
                .text("y = ("+f4(stat[7])+") + ("+ f4(stat[8])+ ") log(t) , " + " r\u00B2 = "+f4(stat[10]))
                .style("stroke",myColor[5]) 
     }
}
function showModel6(stat, ydata, checkTitle) {
     var cx, cy, temp;
     var x1, y1, x2, y2;
     // forecasting
     for (i=tobs; i<tobs+nforecast; i++) {
          cx = margin.left+graphWidth*(tdata[i]-gxmin)/gxrange;
          cy = margin.top+graphHeight-graphHeight*(ydata[i]-gymin)/gyrange; 
          svg.append("circle").attr("class","reglabel6")
             .attr("cx", cx)
             .attr("cy", cy)         
             .attr("r", 3)
             .style("fill",myColor[1])
     }
     x1  = margin.left + graphWidth*(tdata[tobs-1]-gxmin)/gxrange;
     y1  = margin.top  + graphHeight - graphHeight*(ydata[tobs-1]-gymin)/gyrange;
     for (i=tobs; i<tobs+nforecast; i++) {
          x2 = margin.left+graphWidth*(tdata[i]-gxmin)/gxrange;
          y2 = margin.top+graphHeight-graphHeight*(ydata[i]-gymin)/gyrange; 
          svg.append("line").attr("class","reglabel1")
                .attr("x1",x1)
                .attr("y1",y1)
                .attr("x2",x2)
                .attr("y2",y2)
                .style("stroke",myColor[1])
          x1 = x2;
          y1 = y2; 
     }
     // trend line
     var ninterval = 100;
     var gxgap     = gxrange / ninterval;

     x1  = margin.left + graphWidth*(stat[3]-gxmin)/gxrange;
     y1  = margin.top  + graphHeight - graphHeight*(Math.exp(stat[7])*Math.pow(stat[3],stat[8])-gymin)/gyrange;
     for (i = 1; i < ninterval-6; i++) {
          x2  = margin.left + graphWidth*(stat[3]+i*gxgap-gxmin)/gxrange;
          y2  = margin.top  + graphHeight - graphHeight*(Math.exp(stat[7])*Math.pow(stat[3]+i*gxgap,stat[8])-gymin)/gyrange;
          svg.append("line").attr("class","reglabel6")
                .attr("x1",x1)
                .attr("y1",y1)
                .attr("x2",x2)
                .attr("y2",y2)
                .style("stroke",myColor[6]) 
          x1 = x2;
          y1 = y2;
     }
     if(checkTitle) {   
        svg.append("text").attr("class","reglabel6")
                .attr("x", margin.left + 20)
                .attr("y", margin.top +  20)
                .text("y = ("+f4(Math.exp(stat[7]))+") * t ^("+ f4(stat[8])+ ") , " + " r\u00B2 = "+f4(stat[10]))
                .style("stroke",myColor[6]) 
     }
}

function showModel7(stat, ydata, checkTitle) {
     var cx, cy, temp;
     var x1, y1, x2, y2;
     // forecasting
     for (i=tobs; i<tobs+nforecast; i++) {
          cx = margin.left+graphWidth*(tdata[i]-gxmin)/gxrange;
          cy = margin.top+graphHeight-graphHeight*(ydata[i]-gymin)/gyrange; 
          svg.append("circle").attr("class","reglabel7")
             .attr("cx", cx)
             .attr("cy", cy)         
             .attr("r", 3)
             .style("fill",myColor[1])
     }
     x1  = margin.left + graphWidth*(tdata[tobs-1]-gxmin)/gxrange;
     y1  = margin.top  + graphHeight - graphHeight*(ydata[tobs-1]-gymin)/gyrange;
     for (i=tobs; i<tobs+nforecast; i++) {
          temp = (Math.exp(stat[7])*Math.exp(stat[8]*tdata[i]))*SI[i % ma1N];
          x2 = margin.left+graphWidth*(tdata[i]-gxmin)/gxrange;
          y2 = margin.top+graphHeight-graphHeight*(ydata[i]-gymin)/gyrange; 
          svg.append("line").attr("class","reglabel1")
                .attr("x1",x1)
                .attr("y1",y1)
                .attr("x2",x2)
                .attr("y2",y2)
                .style("stroke",myColor[1])
          x1 = x2;
          y1 = y2; 
     }
     // trend line
     var ninterval = 100;
     var gxgap     = gxrange / ninterval;
     x1  = margin.left + graphWidth*(stat[3]-gxmin)/gxrange;
     y1  = margin.top  + graphHeight - graphHeight*(Math.exp(stat[7])*Math.exp(stat[8]*(stat[3]))-gymin)/gyrange;
     for (i = 1; i < ninterval-6; i++) {
          x2  = margin.left + graphWidth*(stat[3]+i*gxgap-gxmin)/gxrange;
          y2  = margin.top  + graphHeight - graphHeight*(Math.exp(stat[7])*Math.exp(stat[8]*(stat[3]+i*gxgap))-gymin)/gyrange;
          svg.append("line").attr("class","reglabel7")
                .attr("x1",x1)
                .attr("y1",y1)
                .attr("x2",x2)
                .attr("y2",y2)
                .style("stroke",myColor[7]) 
          x1 = x2;
          y1 = y2;
     }
     if(checkTitle) {   
        svg.append("text").attr("class","reglabel7")
                .attr("x", margin.left + 20)
                .attr("y", margin.top +  20)
                .text("y = ("+f4(Math.exp(stat[7]))+") + * exp("+ f4(stat[8])+ " t ), " + " r\u00B2 = "+f4(stat[10]))
                .style("stroke",myColor[7]) 
     }
}
// Remove Regression Line of Simulation
function clearScreenOnly() {
     svg.selectAll("*").remove();
     clearPrevious();
     document.getElementById("model1").checked=false;
     document.getElementById("model2").checked=false;
     document.getElementById("model3").checked=false;
     document.getElementById("model4").checked=false;
     document.getElementById("model5").checked=false;
     document.getElementById("model6").checked=false;
     document.getElementById("model7").checked=false;
     document.getElementById("nn42").value = 0;
}
function clearScreen(){
     svg.selectAll("*").remove();
     nforecast = parseFloat(d3.select("#nn42").node().value);
     for (i=0; i<tobs; i++) xdata[i] = tdata[i];  
     model1Stat(tobs, tdata, xdata, ydata, stat1);
     for (i=tobs; i<tobs+nforecast; i++) {
       tdata[i] = i+1;
       xdata[i] = tdata[i];
       ydata[i] = stat1[7] + stat1[8]*tdata[i];
     }
     initialCordinateS(tobs+nforecast, tdata, ydata);
     model = 1;
     checkForecast = false;
     showTimeSeriesPlot(model, tobs, nforecast, tdata, ydata, checkTitle);
     showModel0(tobs, k1, k2, tdata, yhat1, dseason);
     if ( checkModel[1] ) drawModel1();
     if ( checkModel[2] ) drawModel2();
     if ( checkModel[3] ) drawModel3();
     if ( checkModel[4] ) drawModel4();
     if ( checkModel[5] ) drawModel5();
     if ( checkModel[6] ) drawModel6();
     if ( checkModel[7] ) drawModel7();
}
function clearPrevious() {
  removeRegression1();
  removeRegression2();
  removeRegression3();
  removeRegression4();
  removeRegression5();
  removeRegression6();
  removeRegression7();
}
function removeRegression1() {
     checkModel[1] = false;
     document.getElementById("rsquare1").value = "";    
     document.getElementById("equation1").value = "";  
     svg.selectAll("circle.reglabel1").remove();
     svg.selectAll("line.reglabel1").remove();
     svg.selectAll("text.reglabel1").remove();
     svg.selectAll("circle.forecast1").remove();
}
function removeRegression2() {
     checkModel[2] = false;
     document.getElementById("rsquare2").value = "";    
     document.getElementById("equation2").value = "";  
     svg.selectAll("circle.reglabel2").remove();
     svg.selectAll("line.reglabel2").remove();
     svg.selectAll("text.reglabel2").remove();
     svg.selectAll("circle.forecast2").remove();
}
function removeRegression3() {
     checkModel[3] = false;
     document.getElementById("rsquare3").value = "";    
     document.getElementById("equation3").value = "";  
     svg.selectAll("circle.reglabel3").remove();
     svg.selectAll("line.reglabel3").remove();
     svg.selectAll("text.reglabel3").remove();
     svg.selectAll("circle.forecast3").remove();
}
function removeRegression4() {
     checkModel[4] = false;
     document.getElementById("rsquare4").value = "";    
     document.getElementById("equation4").value = "";  
     svg.selectAll("circle.reglabel4").remove();
     svg.selectAll("line.reglabel4").remove();
     svg.selectAll("text.reglabel4").remove();
     svg.selectAll("circle.forecast4").remove();
}
function removeRegression5() {
     checkModel[5] = false;
     document.getElementById("rsquare5").value = "";    
     document.getElementById("equation5").value = "";  
     svg.selectAll("circle.reglabel5").remove();
     svg.selectAll("line.reglabel5").remove();
     svg.selectAll("text.reglabel5").remove();
     svg.selectAll("circle.forecast5").remove();
}
function removeRegression6() {
     checkModel[6] = false;
     document.getElementById("rsquare6").value = "";    
     document.getElementById("equation6").value = "";  
     svg.selectAll("circle.reglabel6").remove();
     svg.selectAll("line.reglabel6").remove();
     svg.selectAll("text.reglabel6").remove();
     svg.selectAll("circle.forecast6").remove();
}
function removeRegression7() {
     checkModel[7] = false;
     document.getElementById("rsquare7").value = "";    
     document.getElementById("equation7").value = "";  
     svg.selectAll("circle.reglabel7").remove();
     svg.selectAll("line.reglabel7").remove();
     svg.selectAll("text.reglabel7").remove();
     svg.selectAll("circle.forecast7").remove();
}
function forecastTableS(model, nobs, nforecast, stat, clow, chigh, S) {
    var screenTable = document.getElementById("screenTable");
    var table = document.createElement('table');
    loc.appendChild(table);
    var row, header;
    var i, j, k, strModel, temp;
    var ncol = 3;
    var cell = new Array(4);
    table.style.fontSize = "13px";

    switch (model) {
      case 0:
        strModel = "y = T × S × I";
        break;
      case 1:
        strModel = "y = "+f4(stat[7])+" + "+f4(stat[8])+" t";
        break;
      case 2:
        strModel = "y = "+f4(stat[0])+" + "+f4(stat[1])+" t +"+f4(stat[2])+" t\u00B2";
        break;
      case 3:
        strModel = "y = "+f4(stat[0])+" + "+f4(stat[1])+" t +"+f4(stat[2])+" t\u00B2"+f4(stat[3])+" t\u00B3";
        break;
      case 4:
        strModel = "y = "+f4(stat[7])+" + "+f4(stat[8])+" √t";
        break;
      case 5:
        strModel = "y = "+f4(stat[7])+" + "+f4(stat[8])+" ln(t)";
        break;
      case 6:
        strModel = "y = "+f4(stat[7])+" t^("+f4(stat[8])+")";
        break;
      case 7:
        strModel = "y = "+f4(stat[7])+" exp("+f4(stat[8])+" t)";
        break;
    }

    k = 0;
    row = table.insertRow(k++);
    row.style.height ="30px";
    if (model == 0) {
      for (j=0; j<2; j++) {
            cell[j] = row.insertCell(j);
            cell[j].style.textAlign = "center";
            cell[j].style.border = "1px solid black";
      }
      cell[0].innerHTML = "<b>"+svgStrU[131][langNum]+"</b> "; // 계절지수
      cell[1].innerHTML = "S(t)";
      cell[0].style.width ="70px";
      cell[1].style.width ="150px";
    }
    else {
      for (j=0; j<ncol; j++) {
            cell[j] = row.insertCell(j);
            cell[j].style.textAlign = "center";
            cell[j].style.border = "1px solid black";
      }
      cell[0].innerHTML = "<b>"+svgStrU[127][langNum]+"</b> "+model;
      cell[1].innerHTML = strModel;
      cell[0].style.width ="70px";
      cell[1].style.width ="150px";
      cell[2].style.width ="200px";
    }

    if (model > 0) {
      row  = table.insertRow(k++);
      row.style.height ="25px";
      for (j=0; j<ncol; j++) {
            cell[j] = row.insertCell(j);
            cell[j].style.backgroundColor = "#eee";
            cell[j].style.textAlign = "center";
            cell[j].style.border = "1px solid black";
      }
      cell[0].innerHTML = "<b>t</b>";
      cell[1].innerHTML = "Y "+ svgStr[84][langNum]; // predicted value
      cell[2].innerHTML = "95% "+svgStrU[20][langNum];  // confidence interval
    }
    if (model == 0) {
      for (i=0; i<ma1N; i++) {
       row = table.insertRow(k++);
       for (j=0; j<2; j++) {
              cell[j] = row.insertCell(j)          
              cell[j].style.textAlign = "center";
              cell[j].style.border = "1px solid black";
       }
       cell[0].innerHTML = i+1;
       cell[1].innerHTML = f4(S[i]);
       cell[0].style.backgroundColor = "#eee";
       cell[0].style.textAlign = "center";
      }
      return;
    }
    for (i=nobs+1; i<=nobs+nforecast; i++) {
       row = table.insertRow(k++);
       for (j=0; j<ncol; j++) {
              cell[j] = row.insertCell(j)          
              cell[j].style.textAlign = "center";
              cell[j].style.border = "1px solid black";
       }
       cell[0].innerHTML = i;
       switch (model) {
         case 1:
           temp = (stat[7] + stat[8]*i)*S[(i-1) % ma1N];
           break;
         case 2:
           temp = (stat[0] + stat[1]*i + stat[2]*i*i)*S[(i-1) % ma1N]; 
           break;
         case 3:
           temp = (stat[0] + stat[1]*i + stat[2]*i*i + stat[3]*i*i*i)*S[(i-1) % ma1N];
           break;
         case 4:
           temp = (stat[7] + stat[8]*Math.sqrt(i))*S[(i-1) % ma1N];
           break;
         case 5:
           temp = (stat[7] + stat[8]*Math.log(i))*S[(i-1) % ma1N];
           break;
         case 6:
           temp = (Math.exp(stat[7]) * Math.pow(i, stat[8]))*S[(i-1) % ma1N];
           break;
         case 7:
           temp = (Math.exp(stat[7]) * Math.exp(stat[8]*i))*S[(i-1) % ma1N];
           break;
       }
       cell[1].innerHTML = f4(temp);
       cell[2].innerHTML = "( "+f4(clow[i-1])+ " , "+f4(chigh[i-1])+ ")";
       cell[0].style.backgroundColor = "#eee";
       cell[0].style.textAlign = "center";
    }
}

// Multiple Linear Regression for polynomial
function statRegression(numVar, prow, ydata, Beta, statF) {
    var i, j, k, nAug;
    var temp, tempx, tempy, sum;
    var SSR, SSE, SST, MSE, info, multpleR, stdErr;
    var avgY, avgYhat, avgResid, SSYH;
    var nAug = 2 * numVar;
    var X = new Array(prow); // 2차원 행렬
    var Y = new Array(prow);
    var yhat        = new Array(prow);
    var residual    = new Array(prow);
    var stdResidual = new Array(prow);
    var Hii         = new Array(prow);
    var Cook        = new Array(prow);
    var T    = new Array(numVar);
//    var Beta = new Array(numVar);
    var Cii  = new Array(numVar);
    var XP   = new Array(numVar); // 2차원 행렬
    var XPX  = new Array(numVar); // 2차원 행렬
    var XPY  = new Array(numVar);
    var L    = new Array(numVar); // 2차원 행렬
    var U    = new Array(numVar); // 2차원 행렬
    var invL = new Array(numVar); // 2차원 행렬
    var invU = new Array(numVar); // 2차원 행렬
//    var invXPX = new Array(numVar); // 2차원 행렬
    for (i = 0; i < prow; i++) {
        X[i] = new Array(numVar);
    }
    for (j = 0; j < numVar; j++) {
        XP[j] = new Array(prow);
        XPX[j] = new Array(numVar);
        L[j] = new Array(nAug);
        U[j] = new Array(nAug);
        invL[j] = new Array(numVar);
        invU[j] = new Array(numVar);
//        invXPX[j] = new Array(numVar);
    }

    // vector Y, matrix X
    for (i = 0; i < prow; i++) {
        Y[i] = ydata[i];
        X[i][0] = 1;
        for (j = 1; j < numVar; j++) {
            X[i][j] = Math.pow(i+1,j);
        } // endof j
    } // endof i
    // matrix XP
    for (i = 0; i < prow; i++) {
        for (j = 0; j < numVar; j++) {
            XP[j][i] = X[i][j];
        } // endof j
    } // endof i
    // matrix XPX
    for (i = 0; i < numVar; i++) {
        for (j = 0; j < numVar; j++) {
            temp = 0;
            for (k = 0; k < prow; k++) {
                temp += XP[i][k] * X[k][j];
            }
            XPX[i][j] = temp;
            L[i][j] = temp;
        }
    }
    // vector XPY
    for (i = 0; i < numVar; i++) {
        sum = 0;
        for (k = 0; k < prow; k++) {
            sum += XP[i][k] * Y[k];
        }
        XPY[i] = sum;
    }
    // Cholesky Decomposition LU
    for (k = 0; k < numVar; k++) {
        for (i = 0; i <= k - 1; i++) {
            sum = 0;
            for (j = 0; j <= i - 1; j++) {
                sum += L[i][j] * L[k][j];
            }
            L[k][i] = (L[k][i] - sum) / L[i][i];
        }
        sum = 0;
        for (j = 0; j <= k - 1; j++) sum += L[k][j] * L[k][j];
        L[k][k] = Math.sqrt(L[k][k] - sum);
    }
    for (i = 0; i < numVar; i++) {
        for (j = 0; j < numVar; j++) {
            if (j > i) L[i][j] = 0;
            U[j][i] = L[i][j];
        }
    }

    // Solve linear Eq  Lt = XPY by forward substitution
    for (k = 0; k < numVar; k++) {
        sum = 0;
        for (j = 0; j < k; j++) sum += L[k][j] * T[j];
        T[k] = (XPY[k] - sum) / L[k][k];
    }
    // Solve linear Eq  Ub = T by forward substitution
    for (k = numVar - 1; k >= 0; k--) {
        sum = 0;
        for (j = numVar - 1; j > k; j--) sum += U[k][j] * Beta[j];
        Beta[k] = (T[k] - sum) / U[k][k];
    }
    // Augment matrix
    for (i = 0; i < numVar; i++) {
        for (k = numVar; k < nAug; k++) {
            if (k == i + numVar) {
                L[i][k] = 1;
                U[i][k] = 1;
            } else {
                L[i][k] = 0;
                U[i][k] = 0;
            }
        }
    }
    // inverse of L by Gauss Elimination
    for (k = 0; k < numVar; k++) {
        temp = L[k][k];
        for (j = k; j < nAug; j++) L[k][j] = L[k][j] / temp;
        for (i = k + 1; i < numVar; i++) {
            temp = L[i][k];
            for (j = k; j < nAug; j++) {
                L[i][j] = L[i][j] - temp * L[k][j];
            }
        }
    }
    for (i = 0; i < numVar; i++) {
        for (j = numVar; j < nAug; j++) invL[i][j - numVar] = L[i][j];
    }
    // inverse of U = (invL)^T
    for (i = 0; i < numVar; i++) {
        for (j = 0; j < numVar; j++) invU[i][j] = invL[j][i];
    }
    // inverse of XPX = (invU)(invL)
    for (i = 0; i < numVar; i++) {
        for (j = 0; j < numVar; j++) {
            sum = 0;
            for (k = 0; k < numVar; k++) sum += invU[i][k] * invL[k][j];
            invXPX[i][j] = sum;
            if (i == j) Cii[i] = invXPX[i][j];
        }
    }
    // Final Test for identity
    for (i = 0; i < numVar; i++) {
        for (j = 0; j < numVar; j++) {
            sum = 0;
            for (k = 0; k < numVar; k++) sum += XPX[i][k] * invXPX[k][j];
        }
    }
    // residual, multiple correlation
    avgY = 0;
    avgYhat = 0;
    for (i = 0; i < prow; i++) {
        sum = Beta[0];
        for (j = 1; j < numVar; j++) {
            sum += Beta[j] * X[i][j];
        } // endof j
        yhat[i] = sum;
        residual[i] = Y[i] - yhat[i];
        avgY += Y[i];
        avgYhat += yhat[i];
    } // endof i
    avgY /= prow;
    avgYhat /= prow;
    // ANOVA Statistics
    SSR = 0;
    SSE = 0;
    SST = 0;
    SSYH = 0;
    for (i = 0; i < prow; i++) {
        tempx = Y[i] - avgY;
        tempy = yhat[i] - avgY;
        SST += tempx * tempx;
        SSR += tempy * tempy;
        SSYH += tempx * tempy;
        SSE += residual[i] * residual[i];
    } // endof i
    MSE = SSE / (prow - numVar);
    stdErr = Math.sqrt(MSE);
    multipleR = SSYH / Math.sqrt(SST * SSR);
    // Hii Leverage : x_i' inv(X'X) x_i
    for (i = 0; i < prow; i++) {
        for (k = 0; k < numVar; k++) {
            T[k] = 0;
            for (j = 0; j < numVar; j++) {
                T[k] += X[i][j] * invXPX[j][k]
            }
        } // endof k
        Hii[i] = 0;
        for (j = 0; j < numVar; j++) {
            Hii[i] += T[j] * X[i][j]
        }
        stdResidual[i] = residual[i] / (stdErr * Math.sqrt(1 - Hii[i]));
        Cook[i] = stdResidual[i] * stdResidual[i] * Hii[i] / ((numVar - 1) * (1 - Hii[i]));
    } // endof i

    statF[0] = prow;
    statF[1] = SSR;
    statF[2] = SSE;
    statF[3] = SST;
    statF[4] = numVar - 1;
    statF[5] = prow - numVar;
    statF[6] = prow - 1;
    statF[7] = SSR / statF[4]; // MSR
    statF[8] = MSE; // MSE
    statF[9] = statF[7] / statF[8]; // Fobs
//    statF[10] = 1 - f_cdf(statF[9], statF[4], statF[5], info);
    statF[11] = stdErr;
    statF[12] = multipleR;
    statF[13] = SSR / SST;

    /*
    console.log("i=0 "+invXPX[0][0]+" "+invXPX[0][1]+" "+invXPX[0][2]);  
    console.log("i=1 "+invXPX[1][0]+" "+invXPX[1][1]+" "+invXPX[1][2]);  
    console.log("i=2 "+invXPX[2][0]+" "+invXPX[2][1]+" "+invXPX[2][2]);  

    console.log("i="+i+" "+L[i][0]+" "+L[i][1]+" "+L[i][2]+" "+L[i][3]+" "+L[i][4]+" "+L[i][5]);
    console.log("k="+k+" "+L[k][0]+" "+L[k][1]+" "+L[k][2]+" "+L[k][3]+" "+L[k][4]+" "+L[k][5]);  
    console.log("k="+k+" "+L[0][0]+" "+L[0][1]+" "+L[0][2]+" "+L[0][3]+" "+L[0][4]+" "+L[0][5]);  
    console.log("k="+k+" "+L[1][0]+" "+L[1][1]+" "+L[1][2]+" "+L[1][3]+" "+L[1][4]+" "+L[1][5]);  
    console.log("k="+k+" "+L[2][0]+" "+L[2][1]+" "+L[2][2]+" "+L[2][3]+" "+L[2][4]+" "+L[2][5]);  
    */
}
// Seasonal time series plot 좌표 계산
function initialCordinateS(tobs, tdata, ydata) {
     xmin = 1;
     xmax = tobs;
     xgap = xmax - xmin;
     xgap = (xmax - xmin) / 20;
     gxmin   = xmin - xgap;
     gxmax   = xmax + xgap;
     gxrange = gxmax - gxmin;
     // Yt 통계량
     ymin = ydata[0];
     ymax = ydata[0];
     for (i=1; i<tobs; i++) {
        if (ymin > ydata[i]) ymin = ydata[i];
        if (ymax < ydata[i]) ymax = ydata[i];
     } 
     ygap    = (ymax*1.2 - ymin) / 10;
     gymin   = ymin - 2*ygap;
     gymax   = ymax*1.2 + 2*ygap;
     gyrange = gymax - gymin;
}


</script>



  <p>
  <h4>13.6.2 Holt-Winters Model</h4>
  <p>

    <div class="mainTable">
      Assume that a time series with a seasonal period \(L\) is observed over \(m\) cycles  as follows:
      <p>
       <table style="width:720px"> 
        <tr> 
          <th class="thGrey" style="width:120px"></th>
          <th class="thGrey" style="width:100px">Season 1</th>
          <th class="thGrey" style="width:100px">Season 2</th>
          <th class="thGrey" style="width:100px">\(\cdots\)</th>
          <th class="thGrey" style="width:100px">Season \(L\)</th>
         <tr> 
           <td class="tdCenter">
             Cycle 1<br>
             Cycle 2<br>
             \(\cdots\)<br>
             Cycle \(m\)<br>
           </td> 
           <td class="tdCenter">
             \(Y_{1}\)<br>
             \(Y_{L+1}\)<br>
             \(\cdots\)<br>
             \(Y_{(m-1)L+1}\)<br>
           </td> 
           <td class="tdCenter">
             \(Y_{2}\)<br>
             \(Y_{L+2}\)<br>
             \(\cdots\)<br>
             \(Y_{(m-1)L+2}\)<br>
          </td> 
           <td class="tdCenter">
             \(\cdots\)<br>
             \(\cdots\)<br>
             \(\cdots\)<br>
             \(\cdots\)<br>
          </td> 
           <td class="tdCenter">
             \(Y_{L}\)<br>
             \(Y_{2L}\)<br>
             \(\cdots\)<br>
             \(Y_{mL}\)<br>
          </td> 
        </tr>
      </table>
      <p>
         The <b>Holt-Winters model</b> is an extension of Holt's linear double exponential smoothing method 
         studied in the previous section to a seasonal model. It consists of a level component \(l_t\), 
         a trend component \(b_t\), and a seasonal component \(s_t\). There are additive model and
         multiplicative model, but only the multiplication model is introduced here.
      $$
        \begin{align}
          {\hat{Y}}_{t+h} &\;=\; (l_{t} \;+\; h \cdot b_{t} ) \cdot s_{t+h-m(k+1)} \\
          l_{t} &\;=\; \alpha \frac{y_t}{s_{t-m} } + (1-\alpha)(l_{t-1} + b_{t-1} )   \\
          b_{t} &\;=\; \beta (l_{t} - l_{t-1} )+(1- \beta ) b_{t-1}   \\
          s_{t} &\;=\; \gamma \;\; \frac{y_{t}}{l_{t-1} + b_{t-1}} \;+\; (1- \gamma ) s_{t-m} 
        \end{align}
      $$
        Here \(k\) is integer part of \((h-1)/m\). \(l_t\) is a time series level, which means the 
        exponential smoothing of the current level (\( \frac{y_t}{s_{t-m} }  \) ) with seasonality 
        removed and the value predicted one time ago \((l_{t-1} + b_{t-1} )  \). \(b_t\) is the slope 
        which is the exponential smoothing of the slope of the current time point \( (l_t - l_{t-1} )\)
        and the previous time point (\(b_{t-1}\)). \(s_t\)  is a seasonal index which is the exponential smoothing
        of the current seasonal component (\(\frac {y_t}{l_{t-1} + b_{t-1} } \)) and the seasonal
        component of the previous season \(s_{t-m}\).
      <p>
        [Table 13.6.3] calculates exponential smoothing values of level, slope, and seasonal indices 
        using the Holt-Winters model with &alpha; = 0.3, &beta; = 0.3, &gamma; = 0.3 to the 
        quarterly sales of a company. The last column is one time prediction at time \(t-1\), 
        \({\hat Y}_{(t-1)+1}\). The initial values \(l_0\) and \(b_0\) are the intercept and 
        slope of the linear regression model for all data, and the initial values of the seasonal index 
        are calculated by the model \(Y \;=\; T \times S \times I  \).
      <p>
      <div class="textLeft">[Table 13.6.3] Holt-Winters Forecasting Model of Quarterly Sales </div>
      <p>
     <table style="width:700px"> 
        <tr> 
          <th class="thGrey" style="width:50px">time</th>
          <th class="thGrey" style="width:150px">Year  Quarter</th>
          <th class="thGrey" style="width:100px">Sales<br>\(Y_t\)</th>
          <th class="thGrey" style="width:100px">Level<br>\(l_t\)</th>
          <th class="thGrey" style="width:100px">Slope<br>\(b_t\)</th>
          <th class="thGrey" style="width:100px">Seasonal<br>\(s_t\)</th>
          <th class="thGrey" style="width:100px">One Time Forecast<br>\(\hat Y _{(t-1)+1}\)</th>
        </tr>
        <tr> 
           <td class="tdCenter">
             -3<br>
             -2<br>
             -1<br>
             0<br>
             1<br>
             2<br>
             3<br>
             4<br>
             5<br>
             6<br>
             7<br>
             8<br>
             9<br>
             10<br>
             11<br>
             12<br>
             13<br>
             14<br>
             15<br>
             16
           </td> 
           <td class="tdCenter">
             <br>
             <br>
             <br>
             <br>
             2018 Quarter 1<br>
             2018-Quarter 2<br>
             2018-Quarter 3<br>
             2018-Quarter 4<br>
             2019 Quarter 1<br>
             2019-Quarter 2<br>
             2019-Quarter 3<br>
             2019-Quarter 4<br>
             2020 Quarter 1<br>
             2020 Quarter 2<br>
             2020 Quarter 3<br>
             2020 Quarter 4<br>
             2021 Quarter 1<br>
             2021 Quarter 2<br>
             2021 Quarter 3<br>
             2021 Quarter 4
           </td> 
           <td class="tdCenter">
             <br>
             <br>
             <br>
                61.2<br>
             62.7312<br>
             64.6753<br>
             65.5795<br>
             63.9809<br>
             66.7081<br>
             68.7061<br>
             71.6766<br>
             75.7320<br>
             76.5997<br>
             78.2283<br>
             79.2477<br>
             81.6382<br>
             83.21580<br>
             84.7427<br>
             86.0501<br>
             88.4618
           </td> 
           <td class="tdCenter">
             <br>
             <br>
             <br>
               1.61<br>
             1.5863<br>
             1.6937<br>
             1.4568<br>
             0.5402<br>
             1.1963<br>
             1.4368<br>
             1.8969<br>
             2.5445<br>
             2.0414<br>
             1.9176<br>
             1.6481<br>
             1.8708<br>
             1.7829<br>
             1.7061<br>
             1.5865<br>
             1.8341
           </td> 
           <td class="tdCenter">
             <br>
             <br>
             <br>
             1.61<br>
             1.5863<br>
             1.6937<br>
             1.4568<br>
             0.5402<br>
             1.1963<br>
             1.4368<br>
             1.8969<br>
             2.5445<br>
             2.0414<br>
             1.9176<br>
             1.6481<br>
             1.8708<br>
             1.7829<br>
             1.7061<br>
             1.5865<br>
             1.8341
           </td> 
           <td class="tdCenter">
             1.1991<br>
             0.9159<br>
             0.8472<br>
             1.0378<br>
             1.1976<br>
             0.9210<br>
             0.8371<br>
             0.9905<br>
             1.2382<br>
             0.9319<br>
             0.8555<br>
             1.0195<br>
             1.2117<br>
             0.9270<br>
             0.8459<br>
             1.0289<br>
             1.2074<br>
             0.9242<br>
             0.8420<br>
             1.0386
           </td> 
           <td class="tdCenter">
             <br>
             <br>
             <br>
             <br>
             75.315<br>
             58.908<br>
             56.230<br>
             69.570<br>
             77.270<br>
             62.539<br>
             58.720<br>
             72.874<br>
             96.920<br>
             73.282<br>
             68.561<br>
             82.477<br>
             01.184<br>
             78.791<br>
             73.124<br>
             90.169
           </td> 
        </tr>
      </table>
      <p>
        &lt;Figure 13.6.2&gt; is the Holt-Winters forecast for the next one year and is calculated as follows:
      $$
        \begin{align}
          & \text{Time 17 :} \quad {\hat Y}_{16+1} \;=\;\; (l_{16} + 1 \times\;b_{16} ) \cdot s_{13} \;=\;(88.4618 + 1.8341)\times1.2074 \;=\;109.024   \\    
          & \text{Time 18 :} \quad {\hat Y}_{16+2} \;=\;\; (l_{16} + 2 \times\;b_{16} ) \cdot s_{14} \;=\;(88.4618+2 \times 1.8341) \times 0.9242\;=\;85.144  \\
          & \text{Time 19 :} \quad {\hat Y}_{16+3} \;=\;\; (l_{16} + 3 \times\;b_{16} ) \cdot s_{15} \;=\;(88.4618+3 \times 1.8341) \times 0.9420\;=\;79.115    \\
          & \text{Time 20 :} \quad {\hat Y}_{16+4} \;=\;\; (l_{16} + 4 \times\;b_{16} ) \cdot s_{16} \;=\;(88.4618+4 \times 1.8341) \times 1.0386\;=\;99.495   \\
        \end{align}
      $$
      <p>

      <!---   ************ html for Time Series - Holt Winter Seasonal ************  ---->
      <b>[<span data-msgid="TimeSeries"></span>  <span data-msgid="Forecasting"></span> : <span data-msgid="HoltWinter"></span>]</b><br>
      <b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Y(t+h) = (L(t) + h × b(t)) × S(t+h-m(k+1)) </b>
      <p>
         <input class="qrBtn" type="image" src="../../QR/eStatU380_TimeseriesHoltWinter.svg" onclick="window.open(addrStr[139])">
      <p>
      <button type="button" id="eraseH" style="width:100px;"><b>New Data</b></button>
      <p>
      <table>
	<tr>
	  <td><b>Y <span data-msgid="input data"></span></b></td>
	  <td colspan="3"><input type="text" size=73 id="data2H"></td>
	</tr>
        <tr>
          <td style="text-align: right;"><b><span data-msgid="Main Title">Main Title</span></b>&nbsp;</td>
          <td colspan="3"><input type="text" size=50 id="mtitleH"></td>
        </tr>
	<tr>
          <td style="text-align: right;"><b><span data-msgid="y title">y title</span></b>&nbsp;</td>
          <td><input type="text" size=15 id="ytitleH"></td>
 	</tr>
	<tr>
          <td><b><span data-msgid="Nseason"></span></b></td>
          <td>&nbsp;&nbsp;L = <input type="number" min="2" max="12" value="4" id="ma1H" style="text-align:center" onchange="clearScreenH()"> <span style="color:red;">( 2 ≤ L ≤ 12)</span></td>
        </tr>
      </table>   
      <p>
      <button type="button" id="executeH"><span data-msgid="Execute">Execute</span></button>
      <table class="stat">
	<tr>
          <td><span data-msgid="ForecastingPeriod"></span></td>
          <td><input type="number" min="0" max="10" value="0" id="nn2H" style="text-align:center" onchange="clearScreenH()"></td>
          <td><span style="color:red;">( ≤ L)</span></td>
 	  <td>&nbsp;&nbsp;<span data-msgid="NumberData"></span></td>         
	  <td><span class="fontmath">n<sub>Y</sub></span></td>
	  <td><input type="text" style="text-align:center;" size=6 id="nn1H"> <span style="color:red;">( ≤ 120)</span></td>     
	</tr>
      </table>
      <svg id="chartH" width="620" height="400" style="border-style:solid;"> </svg> 
      <table>
	<tr>
          <td colspan="3">&nbsp;&nbsp;<span data-msgid="HoltWinter"></span></td>
          <td></td>
          <td>RMSE = <input type="text" class="textarea" size=6 id="mse" style="text-align: right;">&nbsp;</td>
        </tr>
        <tr>
          <td>&nbsp;&nbsp;<span data-msgid="HoltLevel"></span> </td>
          <td>α = <input type="text" size=5 value="0.3" style="text-align:center" id="holtAlpha" onchange="redrawModel1H()"></td>
          <td><span style="color:red;">0 < α < 1</span></td>
          <td> l₀ = &nbsp;<input type="text" size=5 style="text-align:center" id="holtL0" onchange="redrawModel1H()"></td>
          <td><span style="color:blue" data-msgid="Default"></span>: <span style="color:blue" data-msgid="DeseasonIntercept"></span></td>
	</tr>
	<tr>
          <td>&nbsp;&nbsp;<span data-msgid="HoltTrend"></span></td>
          <td>β = <input type="text" size=5 value="0.3" style="text-align:center" id="holtBeta" onchange="redrawModel1H()"></td>
          <td><span style="color:red;">0 < β < 1</span></td>
          <td> b₀ = &nbsp;<input type="text" size=5 style="text-align:center" id="holtT0" onchange="redrawModel1H()"></td>
          <td><span style="color:blue" data-msgid="Default"></span>: <span style="color:blue" data-msgid="DeseasonSlope"></span></td>
	</tr>
	<tr>
          <td>&nbsp;&nbsp;<span data-msgid="Seasonal"></span></td>
          <td>&gamma; = <input type="text" size=5 value="0.3" style="text-align:center" id="holtGamma" onchange="redrawModel1H()"></td>
          <td><span style="color:red;">0 < γ < 1</span></td>
          <td>s₀₁ = <input type="text" size=5 style="text-align:center" id="holtS01" onchange="redrawModel1H()"></td>
          <td><span style="color:blue" data-msgid="Default"></span>: <span style="color:blue" data-msgid="SeasonalIndex"></span>, <span style="color:blue">Y=TSI</span></td>
        </tr>
	<tr>
          <td></td>
          <td></td>
          <td></td>
          <td>s₀₂ = <input type="text" size=5 style="text-align:center" id="holtS02" onchange="redrawModel1H()"></td>
        </tr>
	<tr>
          <td></td>
          <td></td>
          <td></td>
          <td>s₀₃ = <input type="text" size=5 style="text-align:center" id="holtS03" onchange="redrawModel1H()"></td>
        </tr>
	<tr>
          <td></td>
          <td></td>
          <td></td>
          <td>s₀₄ = <input type="text" size=5 style="text-align:center" id="holtS04" onchange="redrawModel1H()"></td>
        </tr>
	<tr>
          <td></td>
          <td></td>
          <td></td>
          <td>s₀₅ = <input type="text" size=5 style="text-align:center" id="holtS05" onchange="redrawModel1H()"></td>
        </tr>
	<tr>
          <td></td>
          <td></td>
          <td></td>
          <td>s₀₆ = <input type="text" size=5 style="text-align:center" id="holtS06" onchange="redrawModel1H()"></td>
        </tr>
	<tr>
          <td></td>
          <td></td>
          <td></td>
          <td>s₀₇ = <input type="text" size=5 style="text-align:center" id="holtS07" onchange="redrawModel1H()"></td>
        </tr>
	<tr>
          <td></td>
          <td></td>
          <td></td>
          <td>s₀₈ = <input type="text" size=5 style="text-align:center" id="holtS08" onchange="redrawModel1H()"></td>
        </tr>
	<tr>
          <td></td>
          <td></td>
          <td></td>
          <td>s₀₉ = <input type="text" size=5 style="text-align:center" id="holtS09" onchange="redrawModel1H()"></td>
        </tr>
	<tr>
          <td></td>
          <td></td>
          <td></td>
          <td>s₀₁₀ = <input type="text" size=5 style="text-align:center" id="holtS10" onchange="redrawModel1H()"></td>
        </tr>
	<tr>
          <td></td>
          <td></td>
          <td></td>
          <td>s₀₁₁ = <input type="text" size=5 style="text-align:center" id="holtS11" onchange="redrawModel1H()"></td>
        </tr>
	<tr>
          <td></td>
          <td></td>
          <td></td>
          <td>s₀₁₂ = <input type="text" size=5 style="text-align:center" id="holtS12" onchange="redrawModel1H()"></td>
        </tr>
	<tr>
 	  <td><button type="button" id="saveGraphH"><span class="tooltiptext" data-msgid="Graph Save">Graph Save</span></button></td>               
          <td><button type="button" id="createTableH"><span class="tooltiptext" data-msgid="ForecastTable"></span></button></td>    
          <td><button type="button" id="saveTableT"><span class="tooltiptext" data-msgid="SaveTable"></span></button></td>
        </tr>
      </table>
      <p>
         <div class="figText">&lt;Figure 13.6.2&gt; Holt-Winters Forecasting of Quarterly Sales </div>
      <p>
      <div> 
        <div id="screenTableH" >
          <div id="locH">
          </div>
        </div>
      </div>
    </div>

    <!---   ************ script for Time Series - Holt Winter Seasonal ************  ---->
  <script>
      setLanguage('en');
      var svgH     = d3.select("#chartH"); 
      var i, r, k, k1, k2;
/*
      var svgWidth    = 620;
      var svgHeight   = 400;
      var margin      = {top: 80, bottom: 50, left: 60, right: 60};
      var buffer      = 40;
      var graphWidth  = svgWidth - margin.left - margin.right;
      var graphHeight = svgHeight - margin.top - margin.bottom;
*/
      var checkTitle  = true;
      var mtitleH, ytitleH, xtitleH, ma1H;
      var tobs, sst, sse, temp, model, mse, rmse;
      var nforecastH = 0;
      var xobs, xmin, xmax, xgap, gxmin, gxmax, gxrange;
      var yobs, ymin, ymax, ygap, gymin, gymax, gyrange;
      var x1, x2, y1, y2;
      var fontsize = "0.8em";
      var sumS      = new Array(30);      
      var numS      = new Array(30);      
      var minS      = new Array(30);      
      var maxS      = new Array(30);      
      var stat1     = new Array(30);
      var tstat     = new Array(30);
      var rowmax    = 200;
      var tdata     = new Array(rowmax);
      var xdata     = new Array(rowmax);
      var ydata     = new Array(rowmax);
      var MA        = new Array(rowmax);
      var CMA       = new Array(rowmax);
      var yhat      = new Array(rowmax);
      var clow      = new Array(rowmax);
      var chigh     = new Array(rowmax);
      var S         = new Array(rowmax);
      var SI        = new Array(rowmax);
      var L         = new Array(rowmax);
      var T         = new Array(rowmax);
      var dseason   = new Array(rowmax);
      var checkForecast = false;
      xtitleH = "t";
      document.getElementById("nn1H").disabled = true;    
      document.getElementById("mse").disabled  = true;       
      svgH.selectAll("*").remove();
      // input data control ===================================================
      d3.select("#data2H").on("input", function() {
        stat = simplestat("#data2H");  
        ydata = data; 
        yobs = stat.n;
      });
      updateData = function() {
        document.getElementById("data2H").value = '';    
      }

      // init example
      document.getElementById("data2H").value = "75,60,54,59,86,65,63,80,90,72,66,85,100,78,72,93";
        stat = simplestat("#data2H");  
        ydata = data; 
        yobs = stat.n;
      document.getElementById("mtitleH").value = "Sales by Quarter";
      document.getElementById("ytitleH").value = "million US$";
  
      // erase Data and Graph
      d3.select("#eraseH").on("click",function() {
        svgH.selectAll("*").remove();
        document.getElementById("data2H").value  = "";
        document.getElementById("mtitleH").value = "";
        document.getElementById("ytitleH").value = "";
        document.getElementById("nn1H").value    = "";
        document.getElementById("nn2H").value    = "0";
        document.getElementById("holtL0").value  = "";    
        document.getElementById("holtT0").value  = "";    
        document.getElementById("mse").value     = "";       
        document.getElementById("holtS01").value = "";    
        document.getElementById("holtS02").value = "";    
        document.getElementById("holtS03").value = "";       
        document.getElementById("holtS04").value = "";       
        document.getElementById("holtS05").value = "";       
        document.getElementById("holtS06").value = "";       
        document.getElementById("holtS07").value = "";       
        document.getElementById("holtS08").value = "";       
        document.getElementById("holtS09").value = "";       
        document.getElementById("holtS10").value = "";       
        document.getElementById("holtS11").value = "";       
        document.getElementById("holtS12").value = "";       
     })

      d3.select("#executeH").on("click", function(){  
          svgH.selectAll("*").remove();  // 전화면 제거
          document.getElementById("nn2H").value = 0;
          tobs = yobs;
          // 입력 도수에 숫자 문자 빈칸 있나 체크
          for (i=0; i<tobs; i++) {
            if ( isNaN(ydata[i]) ) {
              svgH.append("text").attr("class","mean").attr("x", 250).attr("y", margin.top + 40)
                 .text(alertMsg[48][langNum]).style("stroke","red").style("font-size","1em");
              return;
            }
          }
          // title
          mtitleH = d3.select("#mtitleH").node().value;
          ytitleH = d3.select("#ytitleH").node().value;
          // time 1,2,... 통계량
          tobs = yobs;
          nforecastH = 0;
          for (i = 0; i < tobs; i++) {
            tdata[i] = i + 1;   // time 1,2,3...
            xdata[i] = tdata[i];
          }
          model1Stat(tobs, tdata, xdata, ydata, stat1);
          sst = stat1[20];
          document.getElementById("nn1H").value = yobs;
          initialCordinate(tobs, tdata, ydata);    
          model = 1;
          showTimeSeriesPlotH(model, tobs, nforecastH, tdata, ydata, checkTitle);
          // Centered Moving Average for N season period => CMA[i]
            ma1H = parseFloat(d3.select("#ma1H").node().value);
            document.getElementById("nn2H").max   = ma1H;
            for (i=0; i<tobs-ma1H+1; i++) {
              sum = 0;
              for (j=i; j<i+ma1H; j++) sum += ydata[j];
              MA[i] = sum / ma1H;
            }
            // N이 홀수 경우
            if (ma1H % 2 == 1) {
              k  = Math.floor((ma1H+1)/2);
              k1 = k-1;
              k2 = tobs - k1;
              for (i=k1; i<k2; i++) {
                CMA[i] = MA[i-k1]
              }
            }
            else {
              k = Math.floor((ma1H)/2);
              k1 = k;
              k2 = tobs - k;
              for (i=k1; i<k2; i++) {
                CMA[i] = 0.5*(MA[i-k1] + MA[i-k1+1]);
              }
            }
          // Seasonal 
            for (i=k1; i<k2; i++)  S[i] = ydata[i] / CMA[i];
            tmin = S[k1];
            tmax = S[k1];
            for (i=k1; i<k2; i++)  {
              if (S[i] > tmax) tmax = S[i];
              if (S[i] < tmin) tmin = S[i];
            }
            for (i=0; i<ma1H; i++) {
              numS[i] = 0;
              sumS[i] = 0; 
              minS[i] = tmax;
              maxS[i] = tmin
            }
            for (i=k1; i<k2; i++) {
              k = i % ma1H;
              numS[k]++;
              sumS[k] += S[i];
              if (S[i] > maxS[k]) maxS[k] = S[i];
              if (S[i] < minS[k]) minS[k] = S[i];
            }
          // Adjusted Seasonal Index
            temp = 0;
            if (tobs > 3*ma1H) {
              for (k=0; k<ma1H; k++) {
                SI[k] = (sumS[k]-maxS[k]-minS[k]) / (numS[k]-2); 
                temp += SI[k];
              }
            } 
            else {
              for (k=0; k<ma1H; k++) {
                SI[k] = (sumS[k]) / (numS[k]); 
                temp += SI[k];
              }
            }
            for (k=0; k<ma1H; k++) {
              SI[k] = SI[k] * ma1H / temp;
            }
          // Deseasonal data
            for (i=0; i<tobs; i++) {
              k = i % ma1H;
              S[i] = SI[k];
              dseason[i] = ydata[i] / S[i];
            }
            drawModel1H();
      })
      // svg Graph Save
      d3.select("#saveGraphH").on("click", function() {
        var svgH = d3.select("#chartH");
        var width = svgWidth;
        var height = svgHeight;
        var svgString = getSVGString(svgH.node());
        svgString2Image(svgString, width, height, 'png', save);
        function save(dataBlob, filesize) {
          saveAs(dataBlob, 'eStatGraphU.png');
        }
      });
      // create Table
      d3.select("#createTableH").on("click", function() {
          if ( nforecastH == 0 ) {alert("Enter forecasting period"); return;}
          else forecastTableH(tobs, nforecastH, yhat);  
      });
      // save Table
      d3.select("#saveTableT").on("click", function() {
        head = '<html><head><meta charset="UTF-8"></head><body>';
        tail = '</body></html>';
        saveAs(new Blob([head + d3.select("#screenTableH").html() + tail]), "eStatULog.html");
      });
// Holt Winter's Seasonal Model
function drawModel1H() {
            var t, strS;
            holtAlpha = parseFloat(d3.select("#holtAlpha").node().value);
            holtBeta  = parseFloat(d3.select("#holtBeta").node().value);
            holtGamma = parseFloat(d3.select("#holtGamma").node().value);
            holtL0    = parseFloat(d3.select("#holtL0").node().value);
            holtT0    = parseFloat(d3.select("#holtT0").node().value);
            holtS01   = parseFloat(d3.select("#holtS01").node().value);
            if (isNaN(holtAlpha) || holtAlpha <= 0 || holtAlpha >=1) {
              alert("Wrong input, α !!!");
              return;
            }
            if (isNaN(holtBeta) || holtBeta <= 0 || holtBeta >=1) {
              alert("Wrong input, β !!!");
              return;
            }
            if (isNaN(holtGamma) || holtGamma <= 0 || holtGamma >=1) {
              alert("Wrong input, γ !!!");
              return;
            }
            if ( isNaN(holtL0) ) {
              holtL0 = stat1[7];
              document.getElementById("holtL0").value = f2(holtL0);
            }
            if ( isNaN(holtT0) ) {
              holtT0 = stat1[8];
              document.getElementById("holtT0").value = f2(holtT0);
            }
            if ( isNaN(holtS01) ) {
              for(i=0; i<ma1H; i++) {
                strS = "holtS0"+(i+1).toString();
                document.getElementById(strS).value = f3(SI[i]);
              }
            }
            else {
              for(i=0; i<ma1H; i++) {
                strS = "#holtS0"+(i+1).toString();
                SI[i] = parseFloat(d3.select(strS).node().value); 
              }
            }
            // Holt-Winter
              L[0] = holtAlpha*ydata[0]/SI[0] + (1-holtAlpha)*(holtL0+holtT0);
              T[0] = holtBeta*(L[0]-holtL0) + (1-holtBeta)*holtT0;
              S[0] = holtGamma*ydata[0]/(holtL0+holtT0) + (1-holtGamma)*SI[0];
              yhat[0] = (holtL0 + holtT0)*SI[0];
              temp = ydata[0] - yhat[0];
              sse  = temp * temp;
            for (i=1; i<ma1H; i++) {
              L[i] = holtAlpha*ydata[i]/SI[i] + (1-holtAlpha)*(L[i-1]+T[i-1]);
              T[i] = holtBeta*(L[i]-L[i-1]) + (1-holtBeta)*T[i-1];
              S[i] = holtGamma*ydata[i]/(L[i-1]+T[i-1]) + (1-holtGamma)*SI[i];
              yhat[i] = (L[i-1] + T[i-1])*SI[i];
              temp = ydata[i] - yhat[i];
              sse  = temp * temp;
            }
            for (i=ma1H; i<tobs; i++) {
              L[i] = holtAlpha*ydata[i]/S[i-ma1H] + (1-holtAlpha)*(L[i-1]+T[i-1]);
              T[i] = holtBeta*(L[i]-L[i-1]) + (1-holtBeta)*T[i-1];
              S[i] = holtGamma*ydata[i]/(L[i-1]+T[i-1]) + (1-holtGamma)*S[i-ma1H];
              yhat[i] = (L[i-1] + T[i-1])*S[i-ma1H];
              temp = ydata[i] - yhat[i];
              sse  = temp * temp;
            }
            mse = sse / tobs;
            rmse = Math.sqrt(mse);
            document.getElementById("mse").value = f4(rmse);
            if (nforecastH > 0) {
              for (i=tobs; i<tobs+nforecastH; i++) {
                yhat[i] = (L[tobs-1] + (i+1-tobs)*T[tobs-1])*S[i-ma1H];
                clow[i]  = yhat[i] - 1.96*rmse*Math.sqrt(k);
                chigh[i] = yhat[i] + 1.96*rmse*Math.sqrt(k);
              }
              confidenceBandH(model, tobs, nforecastH, clow, chigh);
            }
            ibegin = 0;
            strLabel = "reglabel"+model;
            strModel = svgStrU[132][langNum]+" (α="+holtAlpha+", β="+holtBeta+", γ="+holtGamma+")";
            showModelH(strModel, strLabel, tobs, nforecastH, ibegin, xdata, yhat);

}

function redrawModel1H() {
     clearModel1H();
     drawModel1H();
}
function clearModel1H() {
     svgH.selectAll("circle.reglabel1").remove();
     svgH.selectAll("line.reglabel1").remove();
     svgH.selectAll("text.reglabel1").remove();
     svgH.selectAll("circle.forecast1").remove();
}
// Remove Regression Line of Simulation
function clearScreenH(){
     svgH.selectAll("*").remove();
     svgH.selectAll("circle.reglabel1").remove();
     svgH.selectAll("line.reglabel1").remove();
     svgH.selectAll("text.reglabel1").remove();
     svgH.selectAll("circle.forecast1").remove();
     nforecastH = parseFloat(d3.select("#nn2H").node().value);
     for (i=0; i<tobs; i++) xdata[i] = tdata[i];  
     model1Stat(tobs, tdata, xdata, ydata, stat1);
     for (i=tobs; i<tobs+nforecastH; i++) {
       tdata[i] = i+1;
       xdata[i] = tdata[i];
       ydata[i] = stat1[7] + stat1[8]*tdata[i];
     }
     initialCordinateS(tobs+nforecastH, tdata, ydata);
     checkForecast = false;
     model = 1;
     showTimeSeriesPlotH(model, tobs, nforecastH, tdata, ydata, checkTitle);
     drawModel1H()
}

function forecastTableH(nobs, nforecastH, yhat) {
    var screenTableH = document.getElementById("screenTableH");
    var table = document.createElement('table');
    locH.appendChild(table);
    var row, header;
    var i, j, k, strModel, temp;
    var ncol = 3;
    var cell = new Array(4);
    table.style.fontSize = "13px";

    k = 0;
    row = table.insertRow(k++);
    row.style.height ="30px";
    for (j=0; j<ncol; j++) {
            cell[j] = row.insertCell(j);
            cell[j].style.textAlign = "center";
            cell[j].style.border = "1px solid black";
    }
    cell[0].innerHTML = "<b>"+svgStrU[127][langNum]+"</b>";
    cell[1].innerHTML = svgStrU[132][langNum]; // Holt-Winters Seasonal Model;
    cell[0].style.width ="70px";
    cell[1].style.width ="150px";
    cell[2].style.width ="200px";

    row  = table.insertRow(k++);
    row.style.height ="25px";
    for (j=0; j<ncol; j++) {
            cell[j] = row.insertCell(j);
            cell[j].style.backgroundColor = "#eee";
            cell[j].style.textAlign = "center";
            cell[j].style.border = "1px solid black";
    }
    cell[0].innerHTML = "<b>t</b>";
    cell[1].innerHTML = "Y "+ svgStr[84][langNum]; // predicted value
    cell[2].innerHTML = "95% "+svgStrU[20][langNum];  // confidence interval

    for (i=nobs; i<nobs+nforecastH; i++) {
       row = table.insertRow(k++);
       for (j=0; j<ncol; j++) {
              cell[j] = row.insertCell(j)          
              cell[j].style.textAlign = "center";
              cell[j].style.border = "1px solid black";
       }
       cell[0].innerHTML = i;
       cell[1].innerHTML = f4(yhat[i]);
       cell[2].innerHTML = "( "+f4(clow[i])+ " , "+f4(chigh[i])+ ")";
       cell[0].style.backgroundColor = "#eee";
       cell[0].style.textAlign = "center";
    }
}

// Seasonal time series plot 좌표 계산
function initialCordinateS(tobs, tdata, ydata) {
     xmin = 1;
     xmax = tobs;
     xgap = xmax - xmin;
     xgap = (xmax - xmin) / 20;
     gxmin   = xmin - xgap;
     gxmax   = xmax + xgap;
     gxrange = gxmax - gxmin;
     // Yt 통계량
     ymin = ydata[0];
     ymax = ydata[0];
     for (i=1; i<tobs; i++) {
        if (ymin > ydata[i]) ymin = ydata[i];
        if (ymax < ydata[i]) ymax = ydata[i];
     } 
     ygap    = (ymax*1.2 - ymin) / 10;
     gymin   = ymin - ygap;
     gymax   = ymax*1.2 + ygap;
     gyrange = gymax - gymin;
}

function showTimeSeriesPlotH(model, nobs, nforecastH, xdata, ydata, checkTitle) {
     var xgrid    = new Array(nobs);
     var ygrid    = new Array(nobs);
     var tempx    = new Array(nobs);
     var tempy    = new Array(nobs);
     var i, tx, ty;
     var radius = 3;
     var strLabel = "reglabel"+model;
     // 주제목
         svgH.append("text")
            .attr("x", margin.left + graphWidth/2)
            .attr("y", margin.top / 2 + 10)
            .style("font-size", "1.8em")
            .style("font-family", "sans-seirf")
            .style("stroke", "black")
            .style("text-anchor", "middle")
            .text(mtitleH)
     // X축 제목
         svgH.append("text")
            .style("font-size", fontsize)
            .style("font-family", "sans-seirf")
            .style("stroke", "black")
            .style("text-anchor", "middle")
            .attr("x", margin.left + graphWidth / 2)
            .attr("y", margin.top + graphHeight + margin.bottom / 2 + 15)
            .text(xtitleH)
     // Y축 제목
         tx = margin.left / 2 - 30;
         ty = margin.top + 15;
         svgH.append("text")
            .style("font-size", fontsize)
            .style("font-family", "sans-seirf")
            .style("stroke", "black")
            .style("text-anchor", "end")
            .attr("x", tx)
            .attr("y", ty)
            .text(ytitleH)
            .attr("transform", "rotate(-90 30 100)")
     // x축 그리기
        var xScale = d3.scaleLinear().domain([gxmin,gxmax]).range([0,graphWidth])
        xgrid = xScale.ticks();
     // x축 그리드
        for (i = 1; i < xgrid.length; i++) {
          tx = margin.left + xScale(xgrid[i]);
          svgH.append("line")
           .attr("x1", tx)
           .attr("x2", tx)
           .attr("y1", margin.top)
           .attr("y2", margin.top + graphHeight)
           .style("stroke", "lightgrey")
        }
        ty = margin.top + graphHeight;
        svgH.append("g")
             .attr("transform","translate("+margin.left+","+ty+")")
	     .attr("class", "main axis date")
             .call(d3.axisBottom(xScale)) 

        svgH.append("g")
             .attr("transform","translate("+margin.left+","+margin.top+")")
	     .attr("class", "main axis date")
             .call(d3.axisTop(xScale)) 

    // y축 그리기
        var yScale = d3.scaleLinear().domain([gymin,gymax]).range([graphHeight, 0])
        ygrid = yScale.ticks();
    // Y축 그리드
        for (i = 1; i < ygrid.length; i++) {
          ty = margin.top + yScale(ygrid[i]);
          svgH.append("line")
           .attr("x1", margin.left)
           .attr("x2", margin.left + graphWidth)
           .attr("y1", ty)
           .attr("y2", ty)
           .style("stroke", "lightgrey")
        }
        ty = margin.top;
        svgH.append("g")
             .attr("transform","translate("+margin.left+","+ty+")")
	     .attr("class", "main axis date")
             .call(d3.axisLeft(yScale)) 

        var tx = margin.left + graphWidth;
        svgH.append("g")
             .attr("transform","translate("+tx+","+ty+")")
	     .attr("class", "main axis date")
             .call(d3.axisRight(yScale)) 

    // 산점도 점 그리기
    for (i=0; i<nobs; i++) {
          svgH.append("circle")
             .attr("cx", margin.left+graphWidth*(xdata[i]-gxmin)/gxrange)
             .attr("cy", margin.top+graphHeight-graphHeight*(ydata[i]-gymin)/gyrange)         
             .attr("r", radius)
             .attr("class","circle")
             .style("fill","grey")
    }
    x1  = margin.left + graphWidth*(xdata[0]-gxmin)/gxrange;
    y1  = margin.top  + graphHeight - graphHeight*(ydata[0]-gymin)/gyrange;
    for (i=1; i<nobs; i++) {
      x2  = margin.left + graphWidth*(xdata[i]-gxmin)/gxrange;
      y2  = margin.top  + graphHeight - graphHeight*(ydata[i]-gymin)/gyrange;
      svgH.append("line")
         .attr("x1",x1)
         .attr("y1",y1)
         .attr("x2",x2)
         .attr("y2",y2)
         .style("stroke",myColor[0]) 
      x1 = x2;
      y1 = y2;
    }

    // forecast 점 그리기
    if( checkForecast ) {
      for (i=nobs; i<nobs+nforecastH; i++) {
          x2  = margin.left + graphWidth*(xdata[i]-gxmin)/gxrange;
          y2  = margin.top  + graphHeight - graphHeight*(ydata[i]-gymin)/gyrange;
          svgH.append("circle").attr("class",strLabel)
             .attr("cx", margin.left+graphWidth*(xdata[i]-gxmin)/gxrange)
             .attr("cy", margin.top+graphHeight-graphHeight*(ydata[i]-gymin)/gyrange)         
             .attr("r", 3)
             .style("fill",myColor[model])
      }
      x1  = margin.left + graphWidth*(xdata[nobs]-gxmin)/gxrange;
      y1  = margin.top  + graphHeight - graphHeight*(ydata[nobs]-gymin)/gyrange;
      for (i=nobs+1; i<nobs+nforecastH; i++) {
          x2  = margin.left + graphWidth*(xdata[i]-gxmin)/gxrange;
          y2  = margin.top  + graphHeight - graphHeight*(ydata[i]-gymin)/gyrange;
          svgH.append("line").attr("class",strLabel)
             .attr("x1",x1)
             .attr("y1",y1)
             .attr("x2",x2)
             .attr("y2",y2)
             .style("stroke",myColor[model]) 
             x1 = x2;
             y1 = y2;
      }
    }
}
// Draw time series model on the plot
function showModelH(strModel, strLabel, nobs, nforecastH, ibegin, xdata, yhat) {
    var ty = margin.top + model*20;;
    for (i=ibegin; i<nobs+nforecastH; i++) {
          svgH.append("circle").attr("class",strLabel)
             .attr("cx", margin.left+graphWidth*(xdata[i]-gxmin)/gxrange)
             .attr("cy", margin.top+graphHeight-graphHeight*(yhat[i]-gymin)/gyrange)         
             .attr("r", 3)
             .style("fill",myColor[model])
    }

    var x1  = margin.left + graphWidth*(xdata[ibegin]-gxmin)/gxrange;
    var y1  = margin.top  + graphHeight - graphHeight*(yhat[ibegin]-gymin)/gyrange;
    for (i=ibegin+1; i<nobs+nforecastH; i++) {
      var x2  = margin.left + graphWidth*(xdata[i]-gxmin)/gxrange;
      var y2  = margin.top  + graphHeight - graphHeight*(yhat[i]-gymin)/gyrange;
      svgH.append("line").attr("class",strLabel)
                .attr("x1",x1)
                .attr("y1",y1)
                .attr("x2",x2)
                .attr("y2",y2)
                .style("stroke",myColor[model]) 
      x1 = x2;
      y1 = y2;
    }
    if(checkTitle) {   
        svgH.append("text").attr("class",strLabel)
                .attr("x", margin.left + 20)
                .attr("y", ty)
                .text(strModel)
                .style("font-size", fontsize)
                .style("stroke",myColor[model]) 
     }
}

// 신뢰대 그리기
function confidenceBandH(model, tobs, nforecastH, clow, chigh) {
     var tx, ty, pathStr, classStr;
     var bandColor=["LightGrey","LightPink","LightGreen","LightYellow","MistyRose","PaleGoldenRod","LightCyan","Bisque"];
     classStr="reglabel"+model;
     if (nforecastH > 0) {
       removeConfidenceBandH();
       pathStr = "M";
       tx = margin.left+graphWidth*(tdata[tobs]-gxmin)/gxrange;
       pathStr += tx.toString()+",";
       ty = margin.top+graphHeight-graphHeight*(clow[tobs]-gymin)/gyrange;
       pathStr += ty.toString();
       for (i=tobs+1; i<tobs+nforecastH; i++) {
          tx = margin.left+graphWidth*(tdata[i]-gxmin)/gxrange;
          pathStr += "L"+tx.toString()+",";
          ty = margin.top+graphHeight-graphHeight*(clow[i]-gymin)/gyrange;
          pathStr += ty.toString()
       }
       for (i=tobs+nforecastH-1; i>=tobs; i--) {
          tx = margin.left+graphWidth*(tdata[i]-gxmin)/gxrange;
          pathStr += "L"+tx.toString()+",";
          ty = margin.top+graphHeight-graphHeight*(chigh[i]-gymin)/gyrange;
          pathStr += ty.toString()
       }
       tx = margin.left+graphWidth*(tdata[tobs]-gxmin)/gxrange;
       pathStr += "L"+tx.toString()+",";
       ty = margin.top+graphHeight-graphHeight*(clow[tobs]-gymin)/gyrange;
       pathStr += ty.toString()
       svgH.append("path").attr("class",classStr)
          .attr("d", pathStr)
          .style("fill",bandColor[model]) 
          .style("stroke", myColor[model])
     }
}
// 신뢰대 지우기
function removeConfidenceBandH() {
     svgH.selectAll("path.reglabel1").remove();
     svgH.selectAll("path.reglabel2").remove();
     svgH.selectAll("path.reglabel3").remove();
     svgH.selectAll("path.reglabel4").remove();
     svgH.selectAll("path.reglabel5").remove();
     svgH.selectAll("path.reglabel6").remove();
     svgH.selectAll("path.reglabel7").remove();
}
</script>

  <p>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <button type="button" style="width:160px" onclick="moveSection(135)">&#10094; &nbsp;&nbsp;<b>Previous</b></button>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <button type="button" style="width:160px" onclick="moveSection(137)"><b>Next</b>&nbsp;&nbsp; &#10095;</button>
  <p>

</div>
    
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="https://maxcdn.bootstrapcdn.com/js/ie10-viewport-bug-workaround.js"></script>
    <script>
        //document.getElementById('sidebar').getElementsByTagName('ul')[0].className += "nav nav-sidebar";
        
        /* ajust the height when click the toc
           the code is from https://github.com/twbs/bootstrap/issues/1768
        */
        var shiftWindow = function() { scrollBy(0, -50) };
        window.addEventListener("hashchange", shiftWindow);
        function load() { if (window.location.hash) shiftWindow(); }
        
        /*add Bootstrap styles to tables*/
        var tables = document.getElementsByTagName("table");
        for(var i = 0; i < tables.length; ++i){
            tables[i].className += "table table-bordered table-hover";
        }
    </script>

</body>
</html>

